<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.415a7973f">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.ory.sh"]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//sqa-web.ory.sh/";_paq.push(["setTrackerUrl",e+"np.php"]),_paq.push(["setSiteId","2"]);var a=document,p=a.createElement("script"),t=a.getElementsByTagName("script")[0];p.type="text/javascript",p.async=!0,p.src=e+"js/np.js",t.parentNode.insertBefore(p,t)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Kratos" href="/kratos/docs/opensearch.xml"><title data-react-helmet="true">Zero Trust with IAP Proxy | ORY Kratos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v0.5"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v0.5"><meta data-react-helmet="true" property="og:title" content="Zero Trust with IAP Proxy | ORY Kratos"><meta data-react-helmet="true" name="description" content="The Quickstart covers a basic set up that uses client-side"><meta data-react-helmet="true" property="og:description" content="The Quickstart covers a basic set up that uses client-side"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//kratos/docs/guides/zero-trust-iap-proxy-identity-access-proxy"><link data-react-helmet="true" rel="shortcut icon" href="/kratos/docs/img/favico.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//kratos/docs/guides/zero-trust-iap-proxy-identity-access-proxy"><link rel="stylesheet" href="/kratos/docs/styles.6a49189e.css">
<link rel="preload" href="/kratos/docs/styles.d9f29d75.js" as="script">
<link rel="preload" href="/kratos/docs/runtime~main.484c2c0f.js" as="script">
<link rel="preload" href="/kratos/docs/main.5dc5a81b.js" as="script">
<link rel="preload" href="/kratos/docs/2.a5c7a5ab.js" as="script">
<link rel="preload" href="/kratos/docs/3.836fdef5.js" as="script">
<link rel="preload" href="/kratos/docs/18b93cb3.aefa729f.js" as="script">
<link rel="preload" href="/kratos/docs/1be78505.04c324d6.js" as="script">
<link rel="preload" href="/kratos/docs/372.46088aec.js" as="script">
<link rel="preload" href="/kratos/docs/b8d7c5e6.6195a0ba.js" as="script">
<link rel="preload" href="/kratos/docs/09f7143b.85901fd7.js" as="script">
<link rel="preload" href="/kratos/docs/371.ffdc4534.js" as="script">
<link rel="preload" href="/kratos/docs/1.953cb1d0.js" as="script">
<link rel="preload" href="/kratos/docs/afc80642.cfa23105.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/kratos/docs/">Docs</a><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ecosystem</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/ory/${githubRepoName}/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussions</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat</a><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/kratos/docs/">v0.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/kratos/docs/next/guides/zero-trust-iap-proxy-identity-access-proxy">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/kratos/docs/guides/zero-trust-iap-proxy-identity-access-proxy">v0.5</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.4/guides/zero-trust-iap-proxy-identity-access-proxy">v0.4</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.3/guides/zero-trust-iap-proxy-identity-access-proxy">v0.3</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.2/guides/zero-trust-iap-proxy-identity-access-proxy">v0.2</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.1/">v0.1</a></li><li><a class="dropdown__link" href="/kratos/docs/versions">All versions</a></li></ul></div><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/kratos/docs/">Docs</a></li><li class="menu__list-item"><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Ecosystem</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/ory/${githubRepoName}/discussions" target="_blank" rel="noopener noreferrer" class="menu__link">Discussions</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Chat</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/next/guides/zero-trust-iap-proxy-identity-access-proxy">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/kratos/docs/guides/zero-trust-iap-proxy-identity-access-proxy">v0.5</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.4/guides/zero-trust-iap-proxy-identity-access-proxy">v0.4</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.3/guides/zero-trust-iap-proxy-identity-access-proxy">v0.3</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.2/guides/zero-trust-iap-proxy-identity-access-proxy">v0.2</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.1/">v0.1</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/versions">All versions</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy sidebarWithHideableNavbar_CROi"><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_xFc8"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--light_3CMI"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--dark_3ARp"></a><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/quickstart">Quickstart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/configuring">Configuring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/contributing">Contribution Guidelines</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/terminology">Terminology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/ui-user-interface">User Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/identity-data-model">Identity Data Model</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Identity Credentials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/credentials">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/credentials/username-email-password">Username / Email &amp; Password</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/credentials/openid-connect-oidc-oauth2">Social Sign In, OpenID Connect, and OAuth2</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/browser-redirect-flow-completion">HTTP Redirection Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/email-sms">Out-of-band communication via E-Mail and SMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/rest-api">REST API Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/federation">Federation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/concepts/security">Threat Models and Security Profiles</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Self Service (End-User)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service">Concepts and Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/user-registration">User Registration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/user-login">User Login</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/user-settings">User Settings and Profile Updates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/account-recovery">Account Recovery and Password Reset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/verify-email-account-activation">Email and Phone Verification and Account Activation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/user-logout">User Logout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/user-facing-errors">User-Facing Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/flows/2fa-mfa-multi-factor-authentication">MFA / 2FA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/self-service/hooks">Hooks</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/admin/managing-users-identities">Managing Users and Identities</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/sign-in-with-github-google-facebook-linkedin">Sign in with GitHub, GitLab, Google, Facebook, LinkedIn, Microsoft ...</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/login-session">Configuring And Checking for Login Sessions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/configuring-cookies">Configuring Cookies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/setting-up-cors">Setting up Cross-origin resource sharing (CORS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/account-recovery-password-reset">Setting up Account Recovery and Password Reset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/account-activation-email-verification">Setting up Account Activation and E-Mail Verification</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/kratos/docs/guides/zero-trust-iap-proxy-identity-access-proxy">Zero Trust with IAP Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/multi-tenancy-multitenant">Multitenancy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/secret-key-rotation">Secret and Key Rotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/high-availability-ha">High Availability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/docker">Docker Images</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/guides/setting-up-password-hashing-parameters">Setting up Password Hashing Parameters</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/reference/json-schema-json-paths">JSON Schema and JSON Paths</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/reference/html-forms">HTML Form Parser</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/reference/api">REST API</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Command Line Interface (CLI)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos">kratos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-hashers">kratos hashers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-hashers-argon2">kratos hashers argon2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-hashers-argon2-calibrate">kratos hashers argon2 calibrate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities">kratos identities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities-delete">kratos identities delete</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities-get">kratos identities get</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities-import">kratos identities import</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities-list">kratos identities list</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities-patch">kratos identities patch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-identities-validate">kratos identities validate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-jsonnet">kratos jsonnet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-jsonnet-format">kratos jsonnet format</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-jsonnet-lint">kratos jsonnet lint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-migrate">kratos migrate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-migrate-sql">kratos migrate sql</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-remote">kratos remote</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-remote-status">kratos remote status</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-remote-version">kratos remote version</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-serve">kratos serve</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/cli/kratos-version">kratos version</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Debug &amp; Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/debug/csrf">Common Cookie and CSRF Pitfalls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/debug/performance-out-of-memory-password-hashing-argon2">Performance Problems and Out Of Memory Panics Caused by Password Hashing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/sdk">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/milestones">Milestones and Roadmap</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Further Reading</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/further-reading/comparison">Comparison</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/further-reading/kratos-video-tutorials">Video Tutorials</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Hydra</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/hydra" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/hydra/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/hydra" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Oathkeeper</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Keto</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/keto/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: v0.5</span></div><header><h1 class="docTitle_Oumm">Zero Trust with IAP Proxy</h1></header><div class="markdown"><p>The <a href="/kratos/docs/quickstart">Quickstart</a> covers a basic set up that uses client-side
routing in <code>SecureApp</code> to forward requests to ORY Kratos.</p><p>Systems that have more than a few components often use reverse proxies such as
Nginx, Envoy, or Kong to route and authorize traffic to applications. ORY Kratos
works very well in such environments. The purpose of this guide is to clarify
how to use an IAP (Identity and Access Proxy) to authorize incoming requests. In
this tutorial we will be using
<a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer">ORY Oathkeeper</a> to achieve this.</p><p>This guide expects that you have familiarized yourself with ORY Kratos&#x27; concepts
introduced in the <a href="/kratos/docs/quickstart">Quickstart</a>.</p><p>To ensure that no one can access the dashboard without prior authentication, we
are making use of our reverse proxy
(<a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer">ORY Oathkeeper</a>) denying all
unauthenticated traffic to <code>http://secure-app/dashboard</code> and redirecting the
user to the login page at <code>http://secure-app/auth/login</code>. Further, we will
configure access to <code>http://secure-app/auth/login</code> in such a way that access
only works if one is not yet authenticated.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="running-ory-kratos-and-the-ory-oathkeeper-identity-and-access-proxy"></a>Running ORY Kratos and the ORY Oathkeeper Identity and Access Proxy<a class="hash-link" href="#running-ory-kratos-and-the-ory-oathkeeper-identity-and-access-proxy" title="Direct link to heading">#</a></h2><p>Clone the ORY Kratos repository and fetch the latest images:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/ory/kratos.git</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> kratos</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout v0.5.5-alpha.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">docker pull oryd/kratos:latest-sqlite</span></div><div class="token-line" style="color:#393A34"><span class="token plain">docker pull oryd/kratos-selfservice-ui-node:latest</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Next, run the quickstart and add the ORY Oathkeeper config:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">docker-compose </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  -f quickstart.yml </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  -f quickstart-oathkeeper.yml </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  up --build --force-recreate</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This might take a minute or two. Once the output slows down and logs indicate a
healthy system you&#x27;re ready to roll! A healthy system will show something along
the lines of (the order of messages might be reversed):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">kratos_1      | time=&quot;2020-01-20T14:52:13Z&quot; level=info msg=&quot;Starting the admin httpd on: 0.0.0.0:4434&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">kratos_1      | time=&quot;2020-01-20T14:52:13Z&quot; level=info msg=&quot;Starting the public httpd on: 0.0.0.0:4433&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">oathkeeper_1  | {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;TLS has not been configured for api, skipping&quot;,&quot;time&quot;:&quot;2020-01-20T09:22:09Z&quot;}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">oathkeeper_1  | {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Listening on http://:4456&quot;,&quot;time&quot;:&quot;2020-01-20T09:22:09Z&quot;}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">oathkeeper_1  | {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;TLS has not been configured for proxy, skipping&quot;,&quot;time&quot;:&quot;2020-01-20T09:22:09Z&quot;}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">oathkeeper_1  | {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Listening on http://:4455&quot;,&quot;time&quot;:&quot;2020-01-20T09:22:09Z&quot;}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>There are two important factors to get a fully functional system:</h5></div><div class="admonition-content"><ul><li>You need to make sure that ports <code>4433</code>, <code>4434</code>, <code>4436</code>, <code>4455</code>, and
<code>4456</code>Â <a href="https://serverfault.com/questions/309052/check-if-port-is-open-or-closed-on-a-linux-server" target="_blank" rel="noopener noreferrer">are free</a>.</li><li>Make sure to always use <code>127.0.0.1</code> as the hostname; never use <code>localhost</code>!
This is important because browsers treat these two as separate domains and
will therefore have issues with setting and using the right cookies.</li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="network-architecture"></a>Network Architecture<a class="hash-link" href="#network-architecture" title="Direct link to heading">#</a></h3><p>This demo makes use of several services:</p><ol><li><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer">ORY Kratos</a></li></ol><ul><li>Public (&quot;Browser&quot;) API (port 4433)</li><li>Admin API (port 4434) - This is made public only so we can test via the CLI.</li></ul><ol start="2"><li><a href="http://github.com/ory/kratos-selfservice-ui-node" target="_blank" rel="noopener noreferrer">SecureApp</a></li></ol><ul><li>An example application written in NodeJS that implements the login,
registration, logout, dashboard, and other UIs. Because we are accessing this
via a proxy, its port (4435) is not publicly exposed.</li></ul><ol start="3"><li><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer">ORY Oathkeeper</a></li></ol><ul><li>Reverse proxy (port 4455) - a reverse proxy to protect the <strong>SecureApp</strong>.</li><li>API (port 4456) - Oathkeeper&#x27;s API. This is made public only so we can test
via the CLI.</li></ul><ol start="4"><li><a href="https://github.com/mailslurper" target="_blank" rel="noopener noreferrer">MailSlurper</a></li></ol><ul><li>Public (port 4436) - a development SMTP server with which ORY Kratos sends
emails.</li></ul><p>To better understand the application architecture, let&#x27;s take a look at the
network configuration. This assumes that you have at least some understanding of
how Docker networks work:</p><div class="graph_2ogv pointer_3HHX"></div><div class="overlay__FUg pointer_3HHX graph_2ogv"><div class="backdrop_125x graph_2ogv"></div></div><p>As you can see, all requests except for our demo mail server are proxied through
ORY Oathkeeper.</p><p>The next diagram shows how we&#x27;ve configured the routes in ORY Oathkeeper:</p><div class="graph_2ogv pointer_3HHX"></div><div class="overlay__FUg pointer_3HHX graph_2ogv"><div class="backdrop_125x graph_2ogv"></div></div><p>In order to avoid common cross-domain issues with cookies, we&#x27;re using ORY
Oathkeeper to proxy requests to ORY Kratos&#x27; Public API so that all requests come
from the same hostname.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="perform-registration-login-and-logout"></a>Perform Registration, Login, and Logout<a class="hash-link" href="#perform-registration-login-and-logout" title="Direct link to heading">#</a></h2><p>Enough theory! Let&#x27;s start by opening the dashboard: go to
<a href="http://127.0.0.1:4455/dashboard" target="_blank" rel="noopener noreferrer">127.0.0.1:4455/dashboard</a>.</p><p>Check the <a href="/kratos/docs/quickstart">Quickstart</a> for the other flows!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><p>You can find all configuration files used for this quickstart guide in
<a href="https://github.com/ory/kratos/tree/v0.3.0-alpha.1/contrib/quickstart/kratos/email-password" target="_blank" rel="noopener noreferrer"><code>./contrib/quickstart/kratos</code></a>
,
<a href="https://github.com/ory/kratos/blob/v0.3.0-alpha.1/quickstart.yml" target="_blank" rel="noopener noreferrer"><code>./quickstart.yml</code></a>,
and
<a href="https://github.com/ory/kratos/blob/v0.3.0-alpha.1/quickstart-oathkeeper.yml" target="_blank" rel="noopener noreferrer"><code>./quickstart-oathkeeper.yml</code></a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ory-oathkeeper-identity-and-access-proxy"></a>ORY Oathkeeper: Identity and Access Proxy<a class="hash-link" href="#ory-oathkeeper-identity-and-access-proxy" title="Direct link to heading">#</a></h3><p>All configuration for <a href="https://www.ory.sh/oathkeeper/" target="_blank" rel="noopener noreferrer">ORY Oathkeeper</a> resides
in
<a href="https://github.com/ory/kratos/blob/v0.3.0-alpha.1/contrib/quickstart/oathkeeper" target="_blank" rel="noopener noreferrer"><code>./contrib/quickstart/oathkeeper</code></a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="configuration-1"></a>Configuration<a class="hash-link" href="#configuration-1" title="Direct link to heading">#</a></h4><p>We define several configuration options for ORY Oathkeeper such as the port for
the proxy and where to load the access rules from.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="cookie-session-authenticator"></a>Cookie Session Authenticator<a class="hash-link" href="#cookie-session-authenticator" title="Direct link to heading">#</a></h4><p>The
<a href="https://www.ory.sh/docs/oathkeeper/pipeline/authn#cookie_session" target="_blank" rel="noopener noreferrer">Cookie Session Authenticator</a>
is enabled and points to <a href="/kratos/docs/reference/api">ORY Kratos&#x27; <code>/sessions/whoami</code> API</a>.
It uses the <code>ory_kratos_session</code> cookie to identify if a request contains a
session or not:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/.oathkeeper.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">authenticators</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cookie_session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">check_session_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kratos</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">4433/sessions/whoami</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">preserve_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">extra_from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@this&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject_from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;identity.id&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ory_kratos_session</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It&#x27;s doing what the <code>needsLogin</code> function did in the
<a href="/kratos/docs/quickstart">Quickstart</a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="anonymous-authenticator"></a>Anonymous Authenticator<a class="hash-link" href="#anonymous-authenticator" title="Direct link to heading">#</a></h4><p>The
<a href="https://www.ory.sh/docs/oathkeeper/pipeline/authn#anonymous" target="_blank" rel="noopener noreferrer">Anonymous Authenticator</a>
is useful for endpoints that do not need login, such as the registration screen:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/.oathkeeper.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">authenticators</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">anonymous</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> guest</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="allowed-authorizer"></a>Allowed Authorizer<a class="hash-link" href="#allowed-authorizer" title="Direct link to heading">#</a></h4><p>The
<a href="https://www.ory.sh/docs/oathkeeper/pipeline/authz#allowed" target="_blank" rel="noopener noreferrer">Allowed Authenticator</a>
simply allows all users to access the URL. Since we don&#x27;t have Role-based access
control (RBAC) or an Access Control list (ACL) in place for this example, this
will be enough.</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/.oathkeeper.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">authorizers</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allowed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="id-token-mutator"></a>ID Token Mutator<a class="hash-link" href="#id-token-mutator" title="Direct link to heading">#</a></h3><p>The
<a href="https://www.ory.sh/docs/oathkeeper/pipeline/mutator#id_token" target="_blank" rel="noopener noreferrer">ID Token Mutator</a>
takes all the available session information and puts it into a JSON Web Token
(JWT). The protected <code>SecureApp</code> will now receive</p><p><code>Authorization: bearer &lt;jwt...&gt;</code></p><p>in the HTTP Header instead of</p><p><code>Cookie: ory_kratos_session=...</code></p><p>The JWT is signed using a RS256 key. To verify the JWT we can use the public key
provided by ORY Oathkeeper&#x27;s JWKS API:</p><p><code>http://127.0.0.1:4456/.well-known/jwks.json</code></p><p>You can generate the RS256 key yourself by running
<code>oathkeeper credentials generate --alg RS256 &gt; id_token.jwks.json</code>.</p><p>We also enabled the
<a href="https://www.ory.sh/docs/oathkeeper/pipeline/mutator#" target="_blank" rel="noopener noreferrer">NoOp Mutator</a> for the
various other endpoints such as login and registration:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/.oathkeeper.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mutators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">noop</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">id_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">issuer_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">4455/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">jwks_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">///etc/config/oathkeeper/id_token.jwks.json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">claims</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;session&quot;: {{ .Extra | toJson }}</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You could obviously also use other mutators such as the
<a href="https://www.ory.sh/docs/oathkeeper/pipeline/mutator#header" target="_blank" rel="noopener noreferrer">Header Mutator</a> and
use headers such as <code>X-User-ID</code> instead of the JWT.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="error-handling"></a>Error Handling<a class="hash-link" href="#error-handling" title="Direct link to heading">#</a></h3><p>We configure the error handling in such a way that a missing or invalid login
session (when accessed from a browser) redirects to <code>/auth/login</code>:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/.oathkeeper.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> json</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">redirect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">4455/auth/login</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> unauthorized</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> forbidden</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">accept</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># We don&#x27;t want this for application/json requests, only browser requests!</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> text/html</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">verbose</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="access-rules"></a>Access Rules<a class="hash-link" href="#access-rules" title="Direct link to heading">#</a></h3><p>We use <a href="https://github.com/gobwas/glob" target="_blank" rel="noopener noreferrer">glob matching</a> to match the HTTP
requests for our access rules:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/.oathkeeper.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">access_rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">matching_strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> glob</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">repositories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">///etc/config/oathkeeper/access</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">rules.yml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In <code>access-rules.yml</code> we define three rules. The first rule forwards all traffic
matching <code>http://127.0.0.1:4455/.ory/kratos/public/</code> to ORY Kratos&#x27; Public API:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/access-rules.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ory:kratos:public&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">upstream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">preserve_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://kratos:4433&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">strip_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /.ory/kratos/public</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://127.0.0.1:4455/.ory/kratos/public/&lt;**&gt;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">methods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> GET</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POST</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PUT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DELETE</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PATCH</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authenticators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> noop</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authorizer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> allow</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mutators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> noop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The second rule allows anonymous requests to the error page, website assets,
login, registration, and the page for resending the verification email:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/access-rules.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ory:kratos-selfservice-ui-node:anonymous&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">upstream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">preserve_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://kratos-selfservice-ui-node:4435&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://127.0.0.1:4455/&lt;{error,verify,auth/*,**.css,**.js}{/,}&gt;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">methods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> GET</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authenticators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> anonymous</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authorizer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> allow</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mutators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> noop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The final rule requires a valid session before allowing requests to the
dashboard and user settings:</p><div class="mdxCodeBlock_1zKU"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_2eSY">contrib/quickstart/oathkeeper/access-rules.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ory:kratos-selfservice-ui-node:protected&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">upstream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">preserve_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://kratos-selfservice-ui-node:4435&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://127.0.0.1:4455/&lt;{,debug,dashboard,settings}{/,}&gt;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">methods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> GET</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authenticators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cookie_session</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">authorizer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> allow</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mutators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> id_token</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redirect</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">4455/auth/login</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="cleaning-up-docker"></a>Cleaning up Docker<a class="hash-link" href="#cleaning-up-docker" title="Direct link to heading">#</a></h2><p>To clean everything up, you need to bring down the Docker Compose environment
and remove all mounted volumes.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f quickstart.yml -f quickstart-oathkeeper.yml down -v</span></div><div class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f quickstart.yml -f quickstart-oathkeeper.yml </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f -s -v</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/kratos/edit/master/docs/versioned_docs/version-v0.5/guides/zero-trust-iap-proxy-identity-access-proxy.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-12-09T10:17:42.000Z" class="docLastUpdatedAt_1Qna">12/9/2020</time> by <strong>aeneasr</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/kratos/docs/guides/account-activation-email-verification"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Setting up Account Activation and E-Mail Verification</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/kratos/docs/guides/multi-tenancy-multitenant"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multitenancy Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-ory-kratos-and-the-ory-oathkeeper-identity-and-access-proxy" class="table-of-contents__link">Running ORY Kratos and the ORY Oathkeeper Identity and Access Proxy</a><ul><li><a href="#network-architecture" class="table-of-contents__link">Network Architecture</a></li></ul></li><li><a href="#perform-registration-login-and-logout" class="table-of-contents__link">Perform Registration, Login, and Logout</a></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#ory-oathkeeper-identity-and-access-proxy" class="table-of-contents__link">ORY Oathkeeper: Identity and Access Proxy</a></li><li><a href="#id-token-mutator" class="table-of-contents__link">ID Token Mutator</a></li><li><a href="#error-handling" class="table-of-contents__link">Error Handling</a></li><li><a href="#access-rules" class="table-of-contents__link">Access Rules</a></li></ul></li><li><a href="#cleaning-up-docker" class="table-of-contents__link">Cleaning up Docker</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 ORY GmbH</div></div></div></footer></div>
<script src="/kratos/docs/styles.d9f29d75.js"></script>
<script src="/kratos/docs/runtime~main.484c2c0f.js"></script>
<script src="/kratos/docs/main.5dc5a81b.js"></script>
<script src="/kratos/docs/2.a5c7a5ab.js"></script>
<script src="/kratos/docs/3.836fdef5.js"></script>
<script src="/kratos/docs/18b93cb3.aefa729f.js"></script>
<script src="/kratos/docs/1be78505.04c324d6.js"></script>
<script src="/kratos/docs/372.46088aec.js"></script>
<script src="/kratos/docs/b8d7c5e6.6195a0ba.js"></script>
<script src="/kratos/docs/09f7143b.85901fd7.js"></script>
<script src="/kratos/docs/371.ffdc4534.js"></script>
<script src="/kratos/docs/1.953cb1d0.js"></script>
<script src="/kratos/docs/afc80642.cfa23105.js"></script>
<noscript><p><img src="//sqa-web.ory.sh/np.php?idsite=2&amp;rec=1" style="border:0;" alt=""></p></noscript></body>
</html>