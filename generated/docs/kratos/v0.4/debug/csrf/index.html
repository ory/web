<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.ory.sh"]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//sqa-web.ory.sh/";_paq.push(["setTrackerUrl",e+"np.php"]),_paq.push(["setSiteId","2"]);var a=document,p=a.createElement("script"),t=a.getElementsByTagName("script")[0];p.type="text/javascript",p.async=!0,p.src=e+"js/np.js",t.parentNode.insertBefore(p,t)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="Ory Kratos" href="/kratos/docs/opensearch.xml"><title data-react-helmet="true">Common Cookie and CSRF Pitfalls | Ory Kratos</title><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//kratos/docs/v0.4/debug/csrf"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v0.4"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v0.4"><meta data-react-helmet="true" property="og:title" content="Common Cookie and CSRF Pitfalls | Ory Kratos"><meta data-react-helmet="true" name="description" content="Because ORY Kratos is not just an API, but instead talks to your users&#x27; browsers"><meta data-react-helmet="true" property="og:description" content="Because ORY Kratos is not just an API, but instead talks to your users&#x27; browsers"><link data-react-helmet="true" rel="shortcut icon" href="/kratos/docs/img/favico.png"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//kratos/docs/v0.4/debug/csrf"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//kratos/docs/v0.4/debug/csrf" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//kratos/docs/v0.4/debug/csrf" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/kratos/docs/assets/css/styles.d2c68386.css">
<link rel="preload" href="/kratos/docs/assets/js/styles.5a9e403c.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/runtime~main.95c44d2f.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/main.c59896ee.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/2.0cab358e.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/3.cd1d713f.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/b8d7c5e6.3a4456e2.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/481.fe855e6e.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/1721049b.7098eb48.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/17896441.3537c629.js" as="script">
<link rel="preload" href="/kratos/docs/assets/js/0cb1dc4f.9b4bf4b0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/kratos/docs/img/logo-kratos.svg" alt="Ory Kratos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/kratos/docs/img/logo-kratos.svg" alt="Ory Kratos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Home</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ory/kratos/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussions</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Slack</a><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/kratos/docs/v0.4/">v0.4</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/kratos/docs/next/debug/csrf">Next</a></li><li><a class="dropdown__link" href="/kratos/docs/debug/csrf">v0.6</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.5/debug/csrf">v0.5</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/kratos/docs/v0.4/debug/csrf">v0.4</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.3/debug/csrf">v0.3</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.2/debug/csrf">v0.2</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.1/">v0.1</a></li><li><a class="dropdown__link" href="/kratos/docs/versions">All versions</a></li></ul></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/kratos/docs/img/logo-kratos.svg" alt="Ory Kratos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/kratos/docs/img/logo-kratos.svg" alt="Ory Kratos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer" class="menu__link">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos/discussions" target="_blank" rel="noopener noreferrer" class="menu__link">Discussions</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Slack</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/next/debug/csrf">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/debug/csrf">v0.6</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.5/debug/csrf">v0.5</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/kratos/docs/v0.4/debug/csrf">v0.4</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.3/debug/csrf">v0.3</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.2/debug/csrf">v0.2</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.1/">v0.1</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/versions">All versions</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_3h0W"><img src="/kratos/docs/img/logo-kratos.svg" alt="Ory Kratos" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/kratos/docs/img/logo-kratos.svg" alt="Ory Kratos" class="themedImage_1VuW themedImage--dark_hz6m"></a><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/quickstart">Quickstart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/install">Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/ui-user-interface">User Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/identity-user-model">Identity Data Model</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Identity Credentials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/credentials">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/credentials/username-email-password">Username / Email &amp; Password</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/credentials/openid-connect-oidc-oauth2">Social Sign In, OpenID Connect, and OAuth2</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/browser-redirect-flow-completion">HTTP Redirection Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/email-sms">Out-of-band communication via E-Mail and SMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/federation">Federation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/concepts/security">Threat Models and Security Profiles</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Self Service</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service">Before you start reading</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">User Login and User Registration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-login-user-registration">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-login-user-registration/username-email-password">Username or Email and Password</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-login-user-registration/openid-connect-social-sign-in-oauth2">Social Sign In with OpenID Connect and OAuth2</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">User Settings</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-settings">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-settings/user-profile-management">User Profile Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-settings/change-password">Change Password</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-settings/link-unlink-openid-connect-oauth2">Link and Unlink OpenID Connect and OAuth2 Connections</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Account Recovery</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/account-recovery">Account Recovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/account-recovery/password-reset-recovery-link">Recovery Link and Password Reset</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-logout">User Logout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/user-facing-errors">User-Facing Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/verify-email-account-activation">Email and Phone Verification and Account Activation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/flows/2fa-mfa-multi-factor-authentication">MFA / 2FA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/self-service/hooks/index">Hooks</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/guides/sign-in-with-github-google-facebook-linkedin">Sign in with GitHub, Google, Facebook, LinkedIn, Microsoft ...</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/guides/zero-trust-iap-proxy-identity-access-proxy">Zero Trust with IAP Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/guides/account-recovery-password-reset">Setting up Account Recovery and Password Reset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/guides/account-activation-email-verification">Setting up Account Activation and E-Mail Verification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/guides/multi-tenancy-multitenant">Multitenancy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/guides/high-availability-ha">High Availability</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/reference/json-schema-json-paths">JSON Schema and JSON Paths</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/reference/html-forms">HTML Form Parser</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/reference/api">REST API</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Debug &amp; Help</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/kratos/docs/v0.4/debug/csrf">Common Cookie and CSRF Pitfalls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/sdk">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Further Reading</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/v0.4/further-reading/comparison">Comparison</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Hydra</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/hydra/docs" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Oathkeeper</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper/docs" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Keto</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/keto" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/keto/docs" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/keto" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">GitHub</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Ory Kratos <strong>v0.4</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/kratos/docs/debug/csrf">latest version</a></strong> (v0.6).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: v0.4</span></div><header><h1 class="docTitle_3a4h">Common Cookie and CSRF Pitfalls</h1></header><div class="markdown"><p>Because ORY Kratos is not just an API, but instead talks to your users&#x27; browsers
directly, several security measures have been implemented in ORY Kratos. One of
them is protection against CSRF:</p><blockquote><p>CSRF is an attack that tricks the victim into submitting a malicious request.
It inherits the identity and privileges of the victim to perform an undesired
function on the victimâ€™s behalf. For most sites, browser requests
automatically include any credentials associated with the site, such as the
userâ€™s session cookie, IP address, Windows domain credentials, and so forth.
Therefore, if the user is currently authenticated to the site, the site will
have no way to distinguish between the forged request sent by the victim and a
legitimate request sent by the victim.</p><p><a href="https://owasp.org/www-community/attacks/csrf" target="_blank" rel="noopener noreferrer">Source</a></p></blockquote><p>To protect against CSRF, several endpoints are protected by Anti-CSRF measures.
Typically, endpoints accepting <code>POST</code>, <code>DELTE</code>, <code>PUT</code> actions have Anti-CSRF
measures. When rendering a form for example, a
<code>&lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;...&quot;&gt;</code> HTML Input Element is
added. ORY Kratos compares that value to the value set in the Anti-CSRF Cookie.
If the values match, the request is allowed.</p><p>ORY Kratos uses HTTP Cookies to store login sessions when accessed via a
browser.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="common-pitfalls"></a>Common Pitfalls<a class="hash-link" href="#common-pitfalls" title="Direct link to heading">#</a></h2><p>Sometimes, cookies and CSRF just wont work - all requests end up with a 401
Unauthorized or 400 Bad Request. Here are some common causes and easy fixes if
that happens to you!</p><p>Before starting to debug cookie and CSRF issues, make sure to check out the
Chrome Developer Tools (or any comparable technology) Cookies tabs in the
Application tab</p><img alt="Google Chrome Developer Tools - Application Tab - Cookies" src="/kratos/docs/img/docs/csrf_app_tab.png"><p>as well as the network tab - look for <code>Cookie</code> and <code>Set-Cookie</code> HTTP Headers:</p><img alt="Google Chrome Developer Tools - Network Tab - Cookies" src="/kratos/docs/img/docs/csrf_network_tab.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ory-kratos-running-over-http-without-dev-mode-enabled"></a>ORY Kratos running over HTTP without dev-mode enabled<a class="hash-link" href="#ory-kratos-running-over-http-without-dev-mode-enabled" title="Direct link to heading">#</a></h3><p>ORY Kratos&#x27; cookies have the <code>Secure</code> flag enabled by default. This means that
the browser will not send the cookie unless the URL is a HTTPS URL. If you want
ORY Kratos to work with HTTP (e.g. on localhost) you can add the <code>--dev</code> flag:
<code>kratos serve --dev</code>.</p><p>Do not do this in production!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="running-on-separate-sub-domains"></a>Running on separate (sub-)domains<a class="hash-link" href="#running-on-separate-sub-domains" title="Direct link to heading">#</a></h3><p>Cookies work best on the same domain. While it is possible to get cookies
running on subdomains it is not possible to do that across Top Level Domains
(TLDs).</p><p>Make sure that your application (e.g. the SecureApp from the quickstart) and ORY
Krato&#x27;s Public API are available on the same domain - preferably without
subdomains. Hosting both systems and routing paths with a Reverse Proxy such as
Nginx or Envoy or AWS API Gateway is the best solution. For example, routing
<code>https://my-website/kratos/...</code> to ORY Kratos and <code>https://my-website/dashboard</code>
to the SecureApp&#x27;s Dashboard. Alternatively you can use piping in your app as we
do in the Quickstart guide.</p><p>We do not recommend running them on separate subdomains, e.g.
<code>https://kratos.my-website/</code> and <code>https://secureapp.my-website/</code>).</p><p>Running the apps on different TLDs will not work at all, e.g. e.g.
<code>https://kratos-my-website/</code> and <code>https://secureapp-my-website/</code>.</p><p>Running the services on different ports however is ok, if the domain stays the
same.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mixing-up-127001-and-localhost"></a>Mixing up 127.0.0.1 and localhost<a class="hash-link" href="#mixing-up-127001-and-localhost" title="Direct link to heading">#</a></h3><p>As already explained, make sure that the TLD stays the same. This is especially
true for <code>127.0.0.1</code> and <code>localhost</code> which are both separate TLDs. Make sure
that you use <code>127.0.0.1</code> or <code>localhost</code> consistently across your configuration!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="trying-to-access-ory-kratos-cookies-from-client-side-javascript"></a>Trying to access ORY Kratos Cookies from client-side JavaScript<a class="hash-link" href="#trying-to-access-ory-kratos-cookies-from-client-side-javascript" title="Direct link to heading">#</a></h3><p>The cookies ORY Kratos sets cannot be accessed directly from Client-Side
JavaScript because the <code>HttpOnly</code> flag is set. This flag cannot be modified!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="accessing-ory-kratos-apis-from-client-side-javascript--ajax"></a>Accessing ORY Kratos APIs from client-side JavaScript / AJAX<a class="hash-link" href="#accessing-ory-kratos-apis-from-client-side-javascript--ajax" title="Direct link to heading">#</a></h3><p>When implementing a Single Page App (SPA) using AngularJS or ReactJS you
probably want to access ORY Krato&#x27;s Public APIs.</p><p>To prevent several attack vectors, ORY Krato&#x27;s Public API is protected - even
for some GET requests - with Anti-CSRF measures.</p><p>Because AJAX does not send cookies per default, you need to configure your AJAX
request to include cookies. Using the Browser&#x27;s <code>fetch</code> function, you need to
set
<a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters" target="_blank" rel="noopener noreferrer"><code>credentials: &#x27;include&#x27;</code></a>
for example.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="accessing-ory-kratos-apis-from-a-server-side-application"></a>Accessing ORY Kratos APIs from a server-side application<a class="hash-link" href="#accessing-ory-kratos-apis-from-a-server-side-application" title="Direct link to heading">#</a></h3><p>When implementing a server-side application (e.g. in PHP, Java, Go, NodeJS, ...)
make sure to only call ORY Kratos&#x27; APIs through the Admin Port (default <code>4434</code>),
<strong>not</strong> the Public Port (default <code>4433</code>) as the Public Port requires CSRF
Cookies and the Admin Port doesn&#x27;t! Since your server-side application does not
use a browser to interact with Kratos, CSRF Cookies will not be available which
causes API calls to fail.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/kratos/edit/master/docs/versioned_docs/version-v0.4/debug/csrf.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-07-08T08:50:26.000Z" class="lastUpdatedDate_1WI_">7/8/2020</time> by <strong>aeneasr</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/kratos/docs/v0.4/reference/api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« REST API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/kratos/docs/v0.4/sdk"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SDKs Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#common-pitfalls" class="table-of-contents__link">Common Pitfalls</a><ul><li><a href="#ory-kratos-running-over-http-without-dev-mode-enabled" class="table-of-contents__link">ORY Kratos running over HTTP without dev-mode enabled</a></li><li><a href="#running-on-separate-sub-domains" class="table-of-contents__link">Running on separate (sub-)domains</a></li><li><a href="#mixing-up-127001-and-localhost" class="table-of-contents__link">Mixing up 127.0.0.1 and localhost</a></li><li><a href="#trying-to-access-ory-kratos-cookies-from-client-side-javascript" class="table-of-contents__link">Trying to access ORY Kratos Cookies from client-side JavaScript</a></li><li><a href="#accessing-ory-kratos-apis-from-client-side-javascript--ajax" class="table-of-contents__link">Accessing ORY Kratos APIs from client-side JavaScript / AJAX</a></li><li><a href="#accessing-ory-kratos-apis-from-a-server-side-application" class="table-of-contents__link">Accessing ORY Kratos APIs from a server-side application</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Ory GmbH</div></div></div></footer></div>
<script src="/kratos/docs/assets/js/styles.5a9e403c.js"></script>
<script src="/kratos/docs/assets/js/runtime~main.95c44d2f.js"></script>
<script src="/kratos/docs/assets/js/main.c59896ee.js"></script>
<script src="/kratos/docs/assets/js/2.0cab358e.js"></script>
<script src="/kratos/docs/assets/js/3.cd1d713f.js"></script>
<script src="/kratos/docs/assets/js/b8d7c5e6.3a4456e2.js"></script>
<script src="/kratos/docs/assets/js/481.fe855e6e.js"></script>
<script src="/kratos/docs/assets/js/1721049b.7098eb48.js"></script>
<script src="/kratos/docs/assets/js/17896441.3537c629.js"></script>
<script src="/kratos/docs/assets/js/0cb1dc4f.9b4bf4b0.js"></script>
<noscript><p><img src="//sqa-web.ory.sh/np.php?idsite=2&amp;rec=1" style="border:0;" alt=""></p></noscript></body>
</html>