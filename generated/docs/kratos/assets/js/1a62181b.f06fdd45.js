(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[14136],{13919:function(e,n,t){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!a(e)}t.d(n,{b:function(){return a},Z:function(){return r}})},44996:function(e,n,t){"use strict";t.d(n,{C:function(){return s},Z:function(){return o}});var a=t(52263),r=t(13919);function s(){var e=(0,a.Z)().siteConfig,n=(e=void 0===e?{}:e).baseUrl,t=void 0===n?"/":n,s=e.url;return{withBaseUrl:function(e,n){return function(e,n,t,a){var s=void 0===a?{}:a,o=s.forcePrependBaseUrl,i=void 0!==o&&o,l=s.absolute,c=void 0!==l&&l;if(!t)return t;if(t.startsWith("#"))return t;if((0,r.b)(t))return t;if(i)return n+t;var u=t.startsWith(n)?t:n+t.replace(/^\//,"");return c?e+u:u}(s,t,e,n)}}}function o(e,n){return void 0===n&&(n={}),(0,s().withBaseUrl)(e,n)}},58215:function(e,n,t){"use strict";var a=t(67294);n.Z=function(e){var n=e.children,t=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},55064:function(e,n,t){"use strict";t.d(n,{Z:function(){return d}});var a=t(67294),r=t(79443);var s=function(){var e=(0,a.useContext)(r.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},o=t(86010),i="tabItem_1uMI",l="tabItemActive_2DSg";var c=37,u=39;var d=function(e){var n=e.lazy,t=e.block,r=e.defaultValue,d=e.values,p=e.groupId,m=e.className,f=s(),v=f.tabGroupChoices,h=f.setTabGroupChoices,y=(0,a.useState)(r),g=y[0],w=y[1],b=a.Children.toArray(e.children),k=[];if(null!=p){var T=v[p];null!=T&&T!==g&&d.some((function(e){return e.value===T}))&&w(T)}var x=function(e){var n=e.currentTarget,t=k.indexOf(n),a=d[t].value;w(a),null!=p&&(h(p,a),setTimeout((function(){var e,t,a,r,s,o,i,c;(e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.bottom,s=e.right,o=window,i=o.innerHeight,c=o.innerWidth,t>=0&&s<=c&&r<=i&&a>=0)||(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add(l),setTimeout((function(){return n.classList.remove(l)}),2e3))}),150))},E=function(e){var n,t;switch(e.keyCode){case u:var a=k.indexOf(e.target)+1;t=k[a]||k[0];break;case c:var r=k.indexOf(e.target)-1;t=k[r]||k[k.length-1]}null==(n=t)||n.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},m)},d.map((function(e){var n=e.value,t=e.label;return a.createElement("li",{role:"tab",tabIndex:g===n?0:-1,"aria-selected":g===n,className:(0,o.Z)("tabs__item",i,{"tabs__item--active":g===n}),key:n,ref:function(e){return k.push(e)},onKeyDown:E,onFocus:x,onClick:x},t)}))),n?(0,a.cloneElement)(b.filter((function(e){return e.props.value===g}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},b.map((function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==g})}))))}},79443:function(e,n,t){"use strict";var a=(0,t(67294).createContext)(void 0);n.Z=a},26133:function(e,n,t){"use strict";var a=t(67294);n.Z=function(e){var n=e.severity,t=void 0===n?"info":n;return a.createElement("div",{className:"admonition admonition-warning alert alert--"+t},a.createElement("div",{className:"admonition-heading"},a.createElement("h5",null,a.createElement("span",{className:"admonition-icon"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},a.createElement("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"severity")),a.createElement("div",{className:"admonition-content"},a.createElement("p",null,"This flow requires AJAX and you need to ensure that all cookies are sent using the appropriate CORS and ",a.createElement("code",null,"includeCredentials")," ","configurations. Additionally, Ory Kratos and your app must be hosted on the same domain.")))}},88821:function(e,n,t){"use strict";var a=t(67294);n.Z=function(){return a.createElement("div",{className:"admonition admonition-warning alert alert--danger"},a.createElement("div",{className:"admonition-heading"},a.createElement("h5",null,a.createElement("span",{className:"admonition-icon"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},a.createElement("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),a.createElement("div",{className:"admonition-content"},a.createElement("p",null,"Never use API flows to implement Browser applications! Using API flows in Single-Page-Apps as well as server-side apps opens up several potential attack vectors, including Login and other CSRF attacks.")))}},12669:function(e,n,t){"use strict";var a=t(55064),r=t(58215),s=t(67294),o=t(11756),i=t(73295),l=t(25108),c=function(e){var n=e.item;return n.code?(l.warn(n.code,"asfd"),s.createElement(o.Z,{className:"language-"+n.language,children:n.code})):n.image?s.createElement("img",{src:n.image,alt:n.alt}):n.codeFromRemote?s.createElement(i.Z,{language:n.language,link:n.codeFromRemote.link,src:n.codeFromRemote.src}):s.createElement("span",null,"Unknown item type: $",JSON.stringify(n))};n.Z=function(e){var n=e.items;return s.createElement(a.Z,{defaultValue:Object.keys(n)[0],values:Object.keys(n).map((function(e){return{label:n[e].label,value:e}}))},Object.keys(n).map((function(e){return s.createElement(r.Z,{key:e,value:e},s.createElement(c,{item:n[e]}))})))}},15654:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var a=t(55064),r=t(58215),s=t(67294),o=t(73295),i=t.p+"assets/images/browser-61597c2d37644d2e9a6cd62143a17d19.png",l=t.p+"assets/images/browser-3fffa4ddf3b8dbaa9171845af0b1ace3.png",c=t.p+"assets/images/browser-95c5fd81e495c104256cf0460ebd835a.png",u=t.p+"assets/images/browser-22673e53b8fd2d5b86732105f965b818.png",d=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},p=function(e){var n,t=e.flow;switch(t){case"registration":n=s.createElement("img",{src:c,alt:"User Registration HTML Form"});break;case"login":n=s.createElement("img",{src:i,alt:"User Login HTML Form"});break;case"settings":n=s.createElement("img",{src:l,alt:"Profile Settings HTML Form"});break;case"recovery":n=s.createElement("img",{src:u,alt:"Account Recovery HTML Form"});break;case"verification":n=s.createElement("img",{src:u,alt:"Email Verification HTML Form"})}return s.createElement(a.Z,{defaultValue:"browser",values:[{label:"Browser UI",value:"browser"},{label:"Golang (API Flow)",value:"golang"},{label:"ExpressJS",value:"express"},{label:"ReactJS",value:"react"},{label:"React Native",value:"react-native"}]},s.createElement(r.Z,{value:"browser"},n),s.createElement(r.Z,{value:"express"},s.createElement(o.Z,{lang:"js",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/src/routes/"+t+".ts",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/src/routes/"+t+".ts"}),"The views can be rather simple, as Ory Kratos provides you with all the information you need for rendering the forms. The following examples use Handlebars and a generic form generator to render the Flow:",s.createElement(a.Z,{defaultValue:"view",values:[{label:d(t)+" View",value:"view"},{label:"Generic Form View",value:"generic-form"},{label:"Example Input Form Element",value:"input-form"}]},s.createElement(r.Z,{value:"view"},s.createElement(o.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/"+t+".hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/"+t+".hbs"})),s.createElement(r.Z,{value:"generic-form"},s.createElement(o.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/ui.hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/ui.hbs"})),s.createElement(r.Z,{value:"input-form"},s.createElement(o.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/ui_node_input_default.hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/ui_node_input_default.hbs"}))),"The rest of the form partials can be found"," ",s.createElement("a",{href:"https://github.com/ory/kratos-selfservice-ui-node/tree/master/views/partials"},"here"),"."),s.createElement(r.Z,{value:"react"},"A React example is currently in the making."),s.createElement(r.Z,{value:"golang"},s.createElement(o.Z,{lang:"tsx",link:"https://github.com/ory/kratos/blob/master/examples/go/selfservice/"+t+"/main.go.tsx",src:"https://raw.githubusercontent.com/ory/kratos/master/examples/go/selfservice/"+t+"/main.go"}),"The rest of the code examples partials can be found"," ",s.createElement("a",{href:"https://github.com/ory/kratos/blob/master/examples"},"here")),s.createElement(r.Z,{value:"react-native"},s.createElement(o.Z,{lang:"tsx",link:"https://github.com/ory/kratos-selfservice-ui-react-native/blob/master/src/components/Routes/"+d(t)+".tsx",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-react-native/master/src/components/Routes/"+d(t)+".tsx"}),"The views can be rather simple, as Ory Kratos provides you with all the information you need for rendering the forms.",s.createElement(a.Z,{defaultValue:"generic-form",values:[{label:"Generic Form View",value:"generic-form"},{label:"Example Input Form Element",value:"input-form"}]},s.createElement(r.Z,{value:"generic-form"},s.createElement(o.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-react-native/blob/master/src/components/Form/Form.tsx",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-react-native/master/src/components/Form/Form.tsx"})),s.createElement(r.Z,{value:"input-form"},s.createElement(o.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-react-native/blob/master/src/components/Form/Field.tsxs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-react-native/master/src/components/Form/Field.tsx"}))),"The rest of the form partials can be found"," ",s.createElement("a",{href:"https://github.com/ory/kratos-selfservice-ui-react-native/tree/master/src"},"here")))}},73295:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var a=t(67294),r=t(83300),s=t.n(r),o=t(11756),i="container_2x1S",l=t(25108),c=function(e,n){if(!e)return 0;var t=n.findIndex((function(n){return n.indexOf(e)>-1}));return-1===t?0:t},u=function(e){var n=e.src,t=e.title,r=(0,a.useState)(""),u=r[0],d=r[1];(0,a.useEffect)((function(){var t,a,r;s()(n.replace("github.com","raw.githubusercontent.com").replace("/blob/","/")).then((function(e){return e.text()})).then((t=e,a=t.startAt,r=t.endAt,function(e){var n=e.split("\n"),t=c(a,n);t>0&&(n=["// ..."].concat(n.slice(t,-1)));var s=c(r,n);return s>0&&(n=[].concat(n.slice(0,s+1),["// ..."])),n.join("\n")})).then(d).catch(l.error)}),[]);var p="language-"+function(e){var n=e.split(".").pop();switch(n){case"jsx":return"jsx";case"tsx":return"tsx";case"ts":return"typescript";case"go":return"go";case"yaml":case"yml":return"yaml";case"js":return"javascript";case"html":return"html";case"pug":return"pug";default:return n}}(n),m='title="'+(t||function(e){var n=e.match(new RegExp("https://github.com/[^/]+/[^/]+/blob/[^/]+/(.+)","i"))||[];return n.length>=2?n[1]:e}(n))+'"';return a.createElement("div",{className:i},a.createElement(o.Z,{metastring:m,className:p,children:u}))}},92256:function(e,n,t){"use strict";var a=t(67294);n.Z=function(e){var n=e.severity,t=void 0===n?"info":n;return a.createElement("div",{className:"admonition admonition-warning alert alert--"+t},a.createElement("div",{className:"admonition-heading"},a.createElement("h5",null,a.createElement("span",{className:"admonition-icon"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},a.createElement("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"severity")),a.createElement("div",{className:"admonition-content"},a.createElement("p",null,"Ory Kratos and your UI must be on the hosted on same top level domain! You can not host Ory Kratos and your UI on separate top level domains:"),a.createElement("ul",null,a.createElement("li",null,a.createElement("code",null,"kratos.bar.com")," and ",a.createElement("code",null,"ui.bar.com")," will work;"),a.createElement("li",null,a.createElement("code",null,"kratos.bar.com")," and ",a.createElement("code",null,"bar.com")," will work;"),a.createElement("li",null,a.createElement("code",null,"kratos.bar.com")," and ",a.createElement("code",null,"not-ar.com")," will not work."))))}},32527:function(e,n,t){"use strict";t.d(n,{Z:function(){return m}});var a=t(67294),r=t(21140),s=t.n(r),o="graph_1lrJ",i="pointer_3d8u",l="overlay_2fuY",c="visible_2Z3U",u="backdrop_2z5L",d=t(94184),p=t.n(d);s().initialize({startOnLoad:!0,logLevel:"fatal",securityLevel:"strict",arrowMarkerAbsolute:!1,theme:"neutral",flowchart:{useMaxWidth:!0,htmlLabels:!0,rankSpacing:65,nodeSpacing:30,curve:"basis"},sequence:{useMaxWidth:!0},gantt:{useMaxWidth:!0}});var m=function(e){var n,t=e.chart,r=(0,a.useState)(!1),d=r[0],m=r[1],f=(0,a.useState)(void 0),v=f[0],h=f[1],y=(0,a.useState)("mermaid-"+Math.random().toString(36).substr(2,-1))[0],g=function(){return m(!d)};return(0,a.useEffect)((function(){s().render(y,t,(function(e){h(e)}))}),[]),a.createElement(a.Fragment,null,a.createElement("div",{onClick:g,className:p()(o,i),dangerouslySetInnerHTML:{__html:v}}),a.createElement("div",{onClick:g,className:p()(l,i,o,(n={},n[c]=d,n))},a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:p()(u,o),dangerouslySetInnerHTML:{__html:v}})))}},19582:function(e,n,t){"use strict";var a=t(67294),r=t(32527);n.Z=function(e){return a.createElement(r.Z,{chart:(n=e,t=n.flows,s=void 0===t?["login","registration","settings","..."]:t,o=n.interactions,i=void 0===o?['"Log in"','"Sign Up"','"Update Email"',"..."]:o,l=n.success,c=void 0===l?"Perform flow-specific action (e.g. create user, set session cookie, ...)":l,u=s.length>1?"<"+s.join("|")+">":""+s.join("|"),"\nsequenceDiagram\n  participant B as API Client\n  participant K as Ory Kratos\n\n  B->>K: REST GET /self-service/"+u+"/api\n  K--\x3e>K: Create and store new "+s.join(", ")+" flow\n  K->>B: HTTP 200 OK with flow as application/json payload\n  B--\x3e>B: Render form using e.g. Native iOS UI Elements\n  B--\x3e>B: User fills out forms, clicks e.g. "+i+"\n  B->>K: REST POST to e.g. /self-service/"+u+"?flow=...>\n  K--\x3e>K: Validates and processes payload\n  alt Form payload is valid\n    K->>B: "+c+"\n  else Form payload invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K->>B: Respond with e.g. HTTP 400 Bad Request and updated flow as payload\n    B--\x3e>B: Render form and validation errors using e.g. Native iOS UI Elements\n    B--\x3e>K: Repeat flow with input data, submit, validate, ...\n  end\n")});var n,t,s,o,i,l,c,u}},64923:function(e,n,t){"use strict";var a=t(67294),r=t(32527);n.Z=function(e){return a.createElement(a.Fragment,null,a.createElement(r.Z,{chart:(n=e,t=n.flows,s=void 0===t?["login","registration","settings","..."]:t,o=n.interactions,i=void 0===o?['"Log in"','"Sign Up"','"Update Email"',"..."]:o,l=n.success,c=void 0===l?"Perform flow-specific action (e.g. create user, set session cookie, ...)":l,u=s.length>1?"<"+s.join("|")+">":""+s.join("|"),"\nsequenceDiagram\n\n  participant B as Browser\n  participant K as Ory Kratos\n  participant A as Flow UI\n\n  B->>K: Follow link to /self-service/"+u+"/browser\n  K--\x3e>K: Create and store new "+s.join(", ")+" flow\n  K->>B: HTTP 302 Found <selfservice.flows."+u+".ui_url>?flow=<flow-id>\n\n  B->>A: Opens <selfservice.flows.<"+s.join("|")+">.ui_url>?flow=<flow-id>\n  A--\x3e>K: Fetches data to render forms using /selfservice/"+u+"/flows?id=<flow-id>\n  B--\x3e>A: Fills out forms, clicks e.g. "+i.join(", ")+"\n  B->>K: Submits form\n  K--\x3e>K: Validates and processes form payloads\n\n  alt Form payload is valid\n    K->>B: "+c+"\n  else Form payload invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K--\x3e>B: HTTP 302 Found <selfservice.flows."+u+".ui_url>?flow=<flow-id>\n    B->>A: Opens <selfservice.flows."+u+"?flow=<flow-id>\n    A--\x3e>K: Fetches data to render form fields and errors\n    B->>K: Repeat flow with input data, submit, validate, ...\n  end\n")}),a.createElement("p",null,"The ",a.createElement("em",null,"Flow UI")," (",a.createElement("strong",null,"your application!"),') is responsible for rendering the actual Login and Registration HTML Forms. You can of course implement one app for rendering all the Login, Registration, ... screens, and another app (think "Service Oriented Architecture", "Micro-Services" or "Service Mesh") is responsible for rendering your Dashboards, Management Screens, and so on.'));var n,t,s,o,i,l,c,u}},44212:function(e,n,t){"use strict";var a=t(67294),r=t(32527);n.Z=function(e){return a.createElement(r.Z,{chart:(n=e,t=n.flows,s=void 0===t?["login","registration","settings","..."]:t,o=n.interactions,i=void 0===o?['"Log in"','"Sign Up"','"Update Email"',"..."]:o,l=n.success,c=void 0===l?"Perform flow-specific action (e.g. create user, set session cookie, ...)":l,u=s.length>1?"<"+s.join("|")+">":""+s.join("|"),"\nsequenceDiagram\n  participant B as AJAX Client\n  participant K as Ory Kratos\n\n  B->>K: REST GET /self-service/"+u+"/browser\n  K--\x3e>K: Create and store new "+s.join(", ")+" flow\n  K->>B: HTTP 200 OK with flow as application/json payload\n  B--\x3e>B: Render form using HTML input elements\n  B--\x3e>B: User fills out forms, clicks e.g. "+i+"\n  B->>K: REST POST to e.g. /self-service/"+u+"?flow=...>\n  K--\x3e>K: Validates and processes payload\n  alt Form payload is valid\n    K->>B: "+c+"\n  else Form payload invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K->>B: Respond with e.g. HTTP 400 Bad Request and updated flow as payload\n    B--\x3e>B: Render form and validation errors using HTML input elements\n    B--\x3e>K: Repeat flow with input data, submit, validate, ...\n  end\n")});var n,t,s,o,i,l,c,u}},83499:function(e,n,t){"use strict";t.r(n),t.d(n,{contentTitle:function(){return E},default:function(){return Z},frontMatter:function(){return x},metadata:function(){return N},toc:function(){return R}});var a=t(22122),r=t(19756),s=(t(67294),t(3905)),o=t(44996),i=t(32527),l=t(88821),c=t(64923),u=t(44212),d=t(19582),p=t(12669),m={browser:{label:"Browser UI",image:t(66358).Z,alt:"Account Recovery HTML Form with validation errors"},missing:{label:"Missing Email",language:"shell",code:t(99140).Z}},f={browser:{label:"Browser UI",image:t(95107).Z,alt:"Account Recovery HTML Form with success message"},missing:{label:"Email Sent",language:"shell",code:t(83861).Z}},v={browser:{label:"Browser UI",image:t(37470).Z,alt:"Account Recovery HTML Form with an invalid challenge"},missing:{label:"Invalid Challenge",language:"shell",code:t(107).Z}},h={browser:{label:"Browser UI",image:t(89975).Z,alt:"Account Recovery HTML Form with an invalid challenge"},missing:{label:"Update Credentials",language:"shell",code:t(61874).Z}},y=t(15654),g=t(92256),w=t(26133),b=t(55064),k=t(58215),T=["components"],x={id:"account-recovery",title:"Account Recovery and Password Reset"},E=void 0,N={unversionedId:"self-service/flows/account-recovery",id:"version-v0.7/self-service/flows/account-recovery",isDocsHomePage:!1,title:"Account Recovery and Password Reset",description:"getFlowMethodLinkWithErrors,",source:"@site/versioned_docs/version-v0.7/self-service/flows/account-recovery.mdx",sourceDirName:"self-service/flows",slug:"/self-service/flows/account-recovery",permalink:"/kratos/docs/self-service/flows/account-recovery",editUrl:"https://github.com/ory/kratos/edit/master/docs/versioned_docs/version-v0.7/self-service/flows/account-recovery.mdx",version:"v0.7",lastUpdatedBy:"aeneasr",lastUpdatedAt:1626195872,formattedLastUpdatedAt:"7/13/2021",frontMatter:{id:"account-recovery",title:"Account Recovery and Password Reset"},sidebar:"version-v0.7/docs",previous:{title:"User Settings and Profile Updates",permalink:"/kratos/docs/self-service/flows/user-settings"},next:{title:"Email and Phone Verification and Account Activation",permalink:"/kratos/docs/self-service/flows/verify-email-account-activation"}},R=[{value:"Methods",id:"methods",children:[{value:"Recovery <code>link</code> Method",id:"recovery-link-method",children:[]}]},{value:"Initialize Recovery Flow",id:"initialize-recovery-flow",children:[{value:"Recovery for Server-Side Browser Clients",id:"recovery-for-server-side-browser-clients",children:[]},{value:"Recovery for Client-Side (AJAX) Browser Clients",id:"recovery-for-client-side-ajax-browser-clients",children:[]},{value:"Recovery for API Clients and Clients without Browsers",id:"recovery-for-api-clients-and-clients-without-browsers",children:[]}]},{value:"Recovery Flow Payloads",id:"recovery-flow-payloads",children:[{value:"Send Recovery Link to Email",id:"send-recovery-link-to-email",children:[]}]},{value:"Recovery Form Validation",id:"recovery-form-validation",children:[{value:"Recovery Link via Email",id:"recovery-link-via-email",children:[]}]},{value:"Unsuccessful Recovery",id:"unsuccessful-recovery",children:[]},{value:"Successful Recovery",id:"successful-recovery",children:[]},{value:"Code Examples for NodeJS, ReactJS, Go, ...",id:"code-examples-for-nodejs-reactjs-go-",children:[]}],S={toc:R};function Z(e){var n=e.components,t=(0,r.Z)(e,T);return(0,s.kt)("wrapper",(0,a.Z)({},S,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Please read the ",(0,s.kt)("a",{parentName:"p",href:"/kratos/docs/self-service"},"Self-Service Flows")," overview before\ncontinuing with this document."))),(0,s.kt)("p",null,"Account Recovery must be performed if access to an account needs to be\nrecovered. Common use cases include:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},'"Forgot password" flows'),(0,s.kt)("li",{parentName:"ul"},'"Lost MFA device" flows'),(0,s.kt)("li",{parentName:"ul"},"...")),(0,s.kt)("p",null,"There are two Recovery Flow types supported in Ory Kratos:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Flows where the user sits in front of the Browser and the application is",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"a server-side application (e.g. NodeJS, Java, ...)"),(0,s.kt)("li",{parentName:"ul"},"a client-side application (e.g. ReactJS, AngularJS, ...)"))),(0,s.kt)("li",{parentName:"ul"},"Flows where API interaction is required (e.g. mobile app, Smart TV, ...)")),(0,s.kt)("p",null,"The Recovery Flow can be summarized as the following state machine:"),(0,s.kt)(i.Z,{chart:'\nstateDiagram\n  s1: Flow is initialized\n  s2: User Interface renders Recovery Flow Forms\n  s3: Update Recovery Flow with Error Context(s)\n  s4: Recovery challenge initiated (e.g. link via email)\n  s5: Recovery completed, user logged in\n  [*] --\x3e s1 : User clicks "Recover Account"\n  s1 --\x3e s2\n  s2 --\x3e s4 : User provides valid recovery data\n  s2 --\x3e s3 : User provides invalid recovery data\n  s3 --\x3e s2\n  s4 --\x3e s5 : Challenge response valid\n  s4 --\x3e s3 : Challenge response invalid\n  s5 --\x3e [*]\n',mdxType:"Mermaid"}),(0,s.kt)(b.Z,{defaultValue:"oss",values:[{label:"Ory Cloud Platform",value:"ocp"},{label:"Ory Kratos",value:"oss"}],mdxType:"Tabs"},(0,s.kt)(k.Z,{value:"ocp",mdxType:"TabItem"},(0,s.kt)("p",null,"Currently, account recovery is enabled. In the future, disabling account\nrecovery will become an option.")),(0,s.kt)(k.Z,{value:"oss",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"You can configure which methods to use in the Ory Kratos config:\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/my/kratos/config.yml"',title:'"path/to/my/kratos/config.yml"'},"selfservice:\n  methods:\n    link:\n      enabled: true\n      config:\n      # Defines how long a recovery link is valid for (default 1h)\n      lifespan: 15m\n\n  flows:\n    recovery:\n      enabled: true\n\n      # Defines how long a recovery flow (the UI interaction, not the link!)\n      # is valid for (default 1h)\n      lifespan: 15m\n      # ...\n")))),(0,s.kt)("h2",{id:"methods"},"Methods"),(0,s.kt)("p",null,"Currently, one recovery method is supported:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"link")," method performs account recovery (also known as password reset) by\nsending an email containing a recovery link to the user.")),(0,s.kt)("h3",{id:"recovery-link-method"},"Recovery ",(0,s.kt)("inlineCode",{parentName:"h3"},"link")," Method"),(0,s.kt)("p",null,"There are two email types sent by this method:"),(0,s.kt)("p",null,(0,s.kt)("figure",null,(0,s.kt)("img",{alt:"Recovery email sent to unknown address",src:(0,o.Z)("img/docs/mailslurper-recovery-unknown.png")}),(0,s.kt)("figcaption",null,"If the requested email address is an unknown recovery address, an account recovery attempt email is sent to that email address."))),(0,s.kt)("p",null,(0,s.kt)("figure",null,(0,s.kt)("img",{alt:"Recovery email sent to a known recovery address",src:(0,o.Z)("img/docs/mailslurper-recovery-known.png")}),(0,s.kt)("figcaption",null,"If the requested email address is a known recovery address, a recovery link is sent to that email address."))),(0,s.kt)("p",null,"This prevents account enumeration attacks as explained in this\n",(0,s.kt)("a",{parentName:"p",href:"https://www.troyhunt.com/website-enumeration-insanity-how-our-personal-data-is-leaked/"},"brilliant blog post by Troy Hunt"),"."),(0,s.kt)("p",null,"The emails are using templates that can be customised as explained in\n",(0,s.kt)("a",{parentName:"p",href:"/kratos/docs/concepts/email-sms#templates"},"Customizing E-Mail Templates"),". The\ntemplate IDs are:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Unknown email address: ",(0,s.kt)("inlineCode",{parentName:"li"},"recovery_invalid")),(0,s.kt)("li",{parentName:"ul"},"Known email address: ",(0,s.kt)("inlineCode",{parentName:"li"},"recovery_valid"))),(0,s.kt)("p",null,"You should also configure how long a session is privileged. The user will only\nbe able to update his/her password (or any other credential) for the specified\namount of time after clicking on the recovery link."),(0,s.kt)(b.Z,{defaultValue:"oss",values:[{label:"Ory Cloud Platform",value:"ocp"},{label:"Ory Kratos",value:"oss"}],mdxType:"Tabs"},(0,s.kt)(k.Z,{value:"ocp",mdxType:"TabItem"},(0,s.kt)("p",null,"Configuring the privileged session duration will be possible in the future.")),(0,s.kt)(k.Z,{value:"oss",mdxType:"TabItem"},(0,s.kt)("p",null,"You can configure the privileged session duration in the Ory Kratos config:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/kratos/config.yml"',title:'"path/to/kratos/config.yml"'},"selfservice:\n  flows:\n    settings:\n      privileged_session_max_age: 15m\n")))),(0,s.kt)("p",null,"To specify that an identity's trait is a recovery email, use the following\nIdentity JSON Schema:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-diff"},' {\n   "$id": "https://schemas.ory.sh/presets/kratos/quickstart/email-password/identity.schema.json",\n   "$schema": "http://json-schema.org/draft-07/schema#",\n   "title": "Person",\n   "type": "object",\n   "properties": {\n     "traits": {\n       "type": "object",\n       "properties": {\n         "email": {\n           "type": "string",\n           "format": "email",\n           "ory.sh/kratos": {\n             "credentials": {\n               "password": {\n                 "identifier": true\n               }\n             },\n+            "recovery": {\n+              "via": "email"\n+            }\n           }\n         }\n       }\n       "additionalProperties": false\n     }\n   }\n }\n')),(0,s.kt)("h2",{id:"initialize-recovery-flow"},"Initialize Recovery Flow"),(0,s.kt)(g.Z,{mdxType:"DomainWarning"}),(0,s.kt)("p",null,"The first step is to initialize the Recovery Flow. This sets up Anti-CSRF tokens\nand more. Each recovery flow has a ",(0,s.kt)("inlineCode",{parentName:"p"},"state")," parameter which follows the state\nmachine:"),(0,s.kt)(i.Z,{chart:"\nstateDiagram-v2\n\t[*] --\x3e choose_method\n\tchoose_method --\x3e sent_email\n\tsent_email --\x3e sent_email\n\tnote right of sent_email\n\t    The user may fill out the email form input again as a way to re-send the email.\n\tend note\n\tsent_email --\x3e passed_challenge\n\tpassed_challenge --\x3e [*]\n",mdxType:"Mermaid"}),(0,s.kt)("p",null,"where"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"choose_method")," indicates that the user has not chosen a recovery method yet.\nThis is useful when ",(0,s.kt)("inlineCode",{parentName:"li"},"link")," is not the only recovery method active."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"sent_email")," implies that the recovery email has been sent out."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"passed_challenge")," is set when the user has clicked the recovery link and\ncompleted the account recovery.")),(0,s.kt)("h3",{id:"recovery-for-server-side-browser-clients"},"Recovery for Server-Side Browser Clients"),(0,s.kt)("p",null,"The Recovery Flow for browser clients relies on HTTP redirects between Ory\nKratos, your Recovery UI, and the end-user's browser:"),(0,s.kt)(c.Z,{flows:["recovery"],success:"Set session cookie and initialize Settings Flow",interactions:['"Recover account"'],mdxType:"SelfServiceBrowserFlow"}),(0,s.kt)("p",null,"To initialize the Recovery Flow, point the Browser to the initialization\nendpoint:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell-session"},'$ curl -s -i -X GET \\\n    -H "Accept: text/html" \\\n    https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/browser\n\nHTTP/2 302\ndate: Fri, 09 Jul 2021 12:50:38 GMT\ncontent-type: text/html; charset=utf-8\ncontent-length: 120\nlocation: https://playground.projects.oryapis.com/hosted/recovery?flow=33964b22-c364-4217-b6fc-5f381d142d65\ncache-control: private, no-cache, no-store, must-revalidate\nset-cookie: aHR0cHM6Ly9wbGF5Z3JvdW5kLnByb2plY3RzLm9yeWFwaXMuY29tL2FwaS9rcmF0b3MvcHVibGlj_csrf_token=WCOWjhwHy338874TGz6S7ICVp/hFFVHV8Ev7e1hZYSo=; Path=/api/kratos/public; Domain=playground.projects.oryapis.com; Max-Age=31536000; HttpOnly; Secure; SameSite=None\nvary: Origin\nvary: Cookie\nstrict-transport-security: max-age=15724800; includeSubDomains\n\n<a href="https://playground.projects.oryapis.com/hosted/recovery?flow=33964b22-c364-4217-b6fc-5f381d142d65">Found</a>.\n')),(0,s.kt)("p",null,"The server responds with a HTTP 302 redirect to the Recovery UI, appending the\n",(0,s.kt)("inlineCode",{parentName:"p"},"?flow=<flow-id>")," query parameter (see the curl example) to the URL configured\nhere:"),(0,s.kt)(b.Z,{defaultValue:"oss",values:[{label:"Ory Cloud Platform",value:"ocp"},{label:"Ory Kratos",value:"oss"}],mdxType:"Tabs"},(0,s.kt)(k.Z,{value:"ocp",mdxType:"TabItem"},(0,s.kt)("p",null,"The Ory Cloud Platform offers a default UI implementation. Pointing to another\nUI endpoint will be supported in the future.")),(0,s.kt)(k.Z,{value:"oss",mdxType:"TabItem"},(0,s.kt)("p",null,"You can configure which recovery URL to use in the Ory Kratos config:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/config/kratos.yml"',title:'"path/to/config/kratos.yml"'},"selfservice:\n  flows:\n    recovery:\n      # becomes http://127.0.0.1:4455/recovery?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3\n      ui_url: http://127.0.0.1:4455/recovery\n")))),(0,s.kt)("h3",{id:"recovery-for-client-side-ajax-browser-clients"},"Recovery for Client-Side (AJAX) Browser Clients"),(0,s.kt)("p",null,"The Recovery Flow for client-side browser clients relies on AJAX requests."),(0,s.kt)(w.Z,{mdxType:"AjaxWarning"}),(0,s.kt)(u.Z,{flows:["recovery"],success:"Set session cookie and initialize Settings Flow",interactions:['"Recover account"'],mdxType:"SelfServiceSpaFlow"}),(0,s.kt)("p",null,"To initialize the Recovery Flow, call the recovery initialization endpoint and\nset ",(0,s.kt)("inlineCode",{parentName:"p"},"Accept: application/json"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'$ curl -v -s -X GET \\\n    -H "Accept: application/json"  \\\n    https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/browser | jq\n\n> GET /api/kratos/public/self-service/recovery/browser HTTP/2\n> Host: playground.projects.oryapis.com\n> User-Agent: curl/7.64.1\n> Accept: application/json\n\n< HTTP/2 200\n< date: Fri, 09 Jul 2021 09:36:34 GMT\n< content-type: application/json; charset=utf-8\n< content-length: 1241\n< cache-control: private, no-cache, no-store, must-revalidate\n< set-cookie: aHR0cHM6Ly9wbGF5Z3JvdW5kLnByb2plY3RzLm9yeWFwaXMuY29tL2FwaS9rcmF0b3MvcHVibGlj_csrf_token=wSDoLSdDqNJv2uWVWdv5euaQo9UimCFS1GhXokTLU3o=; Path=/api/kratos/public; Domain=playground.projects.oryapis.com; Max-Age=31536000; HttpOnly; Secure; SameSite=None\n< vary: Origin\n< vary: Cookie\n< strict-transport-security: max-age=15724800; includeSubDomains\n\n{\n  "id": "d37e270d-eb84-472a-8032-3f0f01786210",\n  "type": "browser",\n  "expires_at": "2021-06-15T14:27:31.270617Z",\n  "issued_at": "2021-06-15T14:22:31.270617Z",\n  "request_url": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/browser",\n  "ui": {\n    "action": "http://127.0.0.1:4455/self-service/recovery?flow=d37e270d-eb84-472a-8032-3f0f01786210",\n    "method": "POST",\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "17VNGchueAPEYWji/X3ORohTfHUGqA0HPqTJILpE4xYfMNmIvif7xPIIcJdf62809Y1xGRTwhZMz6SyMDtCSag==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": [],\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "link",\n        "attributes": {\n          "name": "email",\n          "type": "email",\n          "required": true,\n          "disabled": false\n        },\n        "messages": [],\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "link",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "value": "link",\n          "disabled": false\n        },\n        "messages": [],\n        "meta": {\n          "label": {\n            "id": 1070005,\n            "text": "Submit",\n            "type": "info"\n          }\n        }\n      }\n    ]\n  },\n  "state": "choose_method"\n}\n')),(0,s.kt)("h3",{id:"recovery-for-api-clients-and-clients-without-browsers"},"Recovery for API Clients and Clients without Browsers"),(0,s.kt)(l.Z,{mdxType:"ApiWarning"}),(0,s.kt)("p",null,"The Recovery Flow for API clients does not use HTTP Redirects and can be\nsummarized as follows:"),(0,s.kt)(d.Z,{flows:["recovery"],success:"Return session token",interactions:['"Recover account"'],mdxType:"SelfServiceApiFlow"}),(0,s.kt)("p",null,"To initialize the API flow, the client calls the API-flow initialization\nendpoint\n(",(0,s.kt)("a",{parentName:"p",href:"/kratos/docs/reference/api#initialize-recovery-flow-for-api-clients"},"REST API Reference"),")\nwhich returns a JSON response:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell-session"},'$ curl -s -X GET \\\n    -H "Accept: application/json"  \\\n    https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/api | jq\n\n{\n  "id": "660cc928-48f1-485b-8003-dc690f5afc35",\n  "type": "api",\n  "expires_at": "2021-07-09T13:52:56.270081773Z",\n  "issued_at": "2021-07-09T12:52:56.270081773Z",\n  "request_url": "http://playground.projects.oryapis.com/self-service/recovery/api",\n  "ui": {\n    "action": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery?flow=660cc928-48f1-485b-8003-dc690f5afc35",\n    "method": "POST",\n    "nodes": [ /* */ ]\n  },\n  "state": "choose_method"\n}\n')),(0,s.kt)("h2",{id:"recovery-flow-payloads"},"Recovery Flow Payloads"),(0,s.kt)("p",null,"Fetching the Recovery Flow\n(",(0,s.kt)("a",{parentName:"p",href:"/kratos/docs/reference/api#get-recovery-flow"},"REST API Reference"),") is usually\nonly required for browser clients but also works for Recovery Flows initialized\nby API clients. All you need is a valid flow ID:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell-session"},'$ flowId=$(curl -s -X GET \\\n    -H "Accept: application/json" \\\n    https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/api | jq -r \'.id\')\n\n$ curl -s -X GET \\\n    -H "Accept: application/json" \\\n    "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/flows?id=$flowId" | jq\n\n{\n  "id": "7c033350-a935-4807-a06e-85cfc2475c75",\n  "type": "api",\n  "expires_at": "2021-07-09T14:00:52.752217Z",\n  "issued_at": "2021-07-09T13:00:52.752217Z",\n  "request_url": "http://playground.projects.oryapis.com/self-service/recovery/api",\n  "active": "default",\n  "ui": {\n    "action": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery?flow=7c033350-a935-4807-a06e-85cfc2475c75",\n    "method": "POST",\n    "nodes": [ /* ... */ ]\n  },\n  "state": "choose_method"\n}\n')),(0,s.kt)("h3",{id:"send-recovery-link-to-email"},"Send Recovery Link to Email"),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"The ",(0,s.kt)("inlineCode",{parentName:"p"},"link")," recovery mode will always open a link in the browser, even if it was\ninitiated by an API client. This is because the user clicks the link in his/her\nemail client, which opens the browser."))),(0,s.kt)("p",null,"When the ",(0,s.kt)("inlineCode",{parentName:"p"},"link")," method is enabled, it will be part of the ",(0,s.kt)("inlineCode",{parentName:"p"},"methods")," payload in\nthe Recovery Flow:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'$ curl -H "Accept: application/json" -s \\\n    \'https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/flows?id=199a2c74-08ca-4f22-b24c-3de3032682f8\' | \\\n      jq -r \'.ui.nodes[] | select(.group=="link")\'\n\n{\n  "type": "input",\n  "group": "link",\n  "attributes": {\n    "name": "email",\n    "type": "email",\n    "required": true,\n    "disabled": false\n  },\n  "messages": null,\n  "meta": {}\n}\n{\n  "type": "input",\n  "group": "link",\n  "attributes": {\n    "name": "method",\n    "type": "submit",\n    "value": "link",\n    "disabled": false\n  },\n  "messages": null,\n  "meta": {\n    "label": {\n      "id": 1070005,\n      "text": "Submit",\n      "type": "info"\n    }\n  }\n}\n')),(0,s.kt)("h2",{id:"recovery-form-validation"},"Recovery Form Validation"),(0,s.kt)("p",null,"The form payloads are then submitted to Ory Kratos which follows up with:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"An HTTP 302 Found redirect pointing to the Registration UI for Browser\nClients;"),(0,s.kt)("li",{parentName:"ul"},"An ",(0,s.kt)("inlineCode",{parentName:"li"},"application/json")," response for API Clients and Client-Side Browser\napplications (e.g. Single Page Apps).")),(0,s.kt)("h3",{id:"recovery-link-via-email"},"Recovery Link via Email"),(0,s.kt)("p",null,"To send the recovery email, the end-user fills out the form. There might be\nvalidation errors such as a malformed email:"),(0,s.kt)(p.Z,{items:m,mdxType:"CodeTabs"}),(0,s.kt)("p",null,"When validation errors happen, browser clients receive a HTTP 302 Found redirect\nto the Recovery Flow UI, containing the Recovery Flow ID which includes the\nerror payloads."),(0,s.kt)("p",null,"For API Clients, the server typically responds with HTTP 400 Bad Request and the\nRecovery Flow in the response payload as JSON."),(0,s.kt)("h4",{id:"successful-submission"},"Successful Submission"),(0,s.kt)("p",null,"On successful submission, an email will be sent to the provided address:"),(0,s.kt)(p.Z,{items:f,mdxType:"CodeTabs"}),(0,s.kt)("h2",{id:"unsuccessful-recovery"},"Unsuccessful Recovery"),(0,s.kt)("p",null,"If the recovery challenge (e.g. the link in the recovery email) is invalid or\nexpired, the user will be HTTP 302 redirected to the Recovery UI."),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"When an invalid or expired challenge is used, Ory Kratos initializes a new\nAccount Recovery flow automatically. This flow will always be a Browser-based\nflow because the challenge is completed by clicking a link!"))),(0,s.kt)("p",null,"The new Recovery Flow includes an error message such as the following:"),(0,s.kt)(p.Z,{items:v,mdxType:"CodeTabs"}),(0,s.kt)("p",null,"Please keep in mind that this part of the flow always involves a Browser!"),(0,s.kt)("h2",{id:"successful-recovery"},"Successful Recovery"),(0,s.kt)("p",null,"Completing account recovery always results in a HTTP 302 redirect with a Ory\nKratos Login Session Cookie to the Settings UI with a Settings Flow prompting\nthe user to update their password or credentials:"),(0,s.kt)(p.Z,{items:h,mdxType:"CodeTabs"}),(0,s.kt)("h2",{id:"code-examples-for-nodejs-reactjs-go-"},"Code Examples for NodeJS, ReactJS, Go, ..."),(0,s.kt)("p",null,"The Recovery User Interface is a route (page / site) in your application\n(server, native app, single page app) that should render a recovery form."),(0,s.kt)("p",null,"In stark contrast to other Identity Systems, Ory Kratos does not render this\nHTML. Instead, you need to implement the HTML code in your application (e.g.\nNodeJS + ExpressJS, Java, PHP, ReactJS, ...), which gives you extreme\nflexibility and customizability in your user interface flows and designs."),(0,s.kt)("p",null,"You will use the Recovery Flow JSON response to render the recovery form UI,\nwhich could looks as follows depending on your programming language and web\nframework:"),(0,s.kt)(y.Z,{flow:"recovery",mdxType:"RenderFlow"}))}Z.isMDXComponent=!0},11748:function(e,n,t){var a={"./locale":89234,"./locale.js":89234};function r(e){var n=s(e);return t(n)}function s(e){if(!t.o(a,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=s,e.exports=r,r.id=11748},83300:function(e,n){"use strict";var t=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();e.exports=n=t.fetch,t.fetch&&(n.default=t.fetch.bind(t)),n.Headers=t.Headers,n.Request=t.Request,n.Response=t.Response},107:function(e,n){"use strict";n.Z='$ curl -H "Accept: application/json" -s \\\n    \'https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/flows?id=db163ca2-5e03-4961-8398-c537ed6c1cb9\' | \\\n      jq\n\n{\n  "id": "db163ca2-5e03-4961-8398-c537ed6c1cb9",\n  "type": "browser",\n  "expires_at": "2021-04-28T13:54:51.358334636Z",\n  "issued_at": "2021-04-28T12:54:51.358334636Z",\n  "request_url": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery?flow=199a2c74-08ca-4f22-b24c-3de3032682f8&token=XSpIPzkW4DgnJVhBG5Wjw3F123Z0ORmGrrq",\n  "ui": {\n    "action": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery?flow=db163ca2-5e03-4961-8398-c537ed6c1cb9",\n    "method": "POST",\n    "messages": [\n      {\n        "id": 4060004,\n        "text": "The recovery token is invalid or has already been used. Please retry the flow.",\n        "type": "error",\n        "context": {}\n      }\n    ],\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "TZ1eswBzgOQF6VC1PdPGR9vX9JfpRiwe6ZWAKpjNwgunyE3C+nF4sgKOB4hXBZTrvUBWWmMLXhXmdq/vIKWLnA==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "link",\n        "attributes": {\n          "name": "email",\n          "type": "email",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "link",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "value": "link",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070005,\n            "text": "Submit",\n            "type": "info"\n          }\n        }\n      }\n    ]\n  },\n  "state": "choose_method"\n}\n'},99140:function(e,n){"use strict";n.Z='$ curl -H "Accept: application/json" -s \\\n    \'https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/flows?id=199a2c74-08ca-4f22-b24c-3de3032682f8\' | \\\n      jq -r \'.ui.nodes[] | select(.group=="link")\'\n\n{\n  "type": "input",\n  "group": "link",\n  "attributes": {\n    "name": "email",\n    "type": "email",\n    "required": true,\n    "disabled": false\n  },\n  "messages": [\n    {\n      "id": 4000002,\n      "text": "Property email is missing.",\n      "type": "error",\n      "context": {\n        "property": "email"\n      }\n    }\n  ],\n  "meta": {}\n}\n{\n  "type": "input",\n  "group": "link",\n  "attributes": {\n    "name": "method",\n    "type": "submit",\n    "value": "link",\n    "disabled": false\n  },\n  "messages": null,\n  "meta": {\n    "label": {\n      "id": 1070005,\n      "text": "Submit",\n      "type": "info"\n    }\n  }\n}\n\n'},83861:function(e,n){"use strict";n.Z='$ curl -H "Accept: application/json" -s \\\n    \'https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/flows?id=199a2c74-08ca-4f22-b24c-3de3032682f8\' | \\\n      jq\n\n{\n  "id": "199a2c74-08ca-4f22-b24c-3de3032682f8",\n  "type": "browser",\n  "expires_at": "2021-04-28T13:47:17.913580042Z",\n  "issued_at": "2021-04-28T12:47:17.913580042Z",\n  "request_url": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery/browser",\n  "active": "link",\n  "ui": {\n    "action": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery?flow=199a2c74-08ca-4f22-b24c-3de3032682f8",\n    "method": "POST",\n    "messages": [\n      {\n        "id": 1060002,\n        "text": "An email containing a recovery link has been sent to the email address you provided.",\n        "type": "info",\n        "context": {}\n      }\n    ],\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "Vax2/oPfhwTkUOHpE6UxDuM2ob+tr3RDTpKe3OHH9H6/+WWPed1/UuM3ttR5c2OihaEDcifiBkhBcbEZWa+96Q==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "link",\n        "attributes": {\n          "name": "email",\n          "type": "email",\n          "value": "foo@ory.sh",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "link",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070005,\n            "text": "Submit",\n            "type": "info"\n          }\n        }\n      }\n    ]\n  },\n  "state": "sent_email"\n}\n'},61874:function(e,n){"use strict";n.Z='$ curl -s -X GET \\\n    -H "Authorization: Bearer $sessionToken"  \\\n    -H "Accept: application/json"  \\\n    \'https://playground.projects.oryapis.com/api/kratos/public/self-service/settings/flows?id=9b527900-2199-4221-9252-7971b3362282\' | \\\n      jq\n\n{\n  "id": "9b527900-2199-4221-9252-7971b3362282",\n  "type": "browser",\n  "expires_at": "2021-04-28T13:55:36.046466067Z",\n  "issued_at": "2021-04-28T12:55:36.046466067Z",\n  "request_url": "https://playground.projects.oryapis.com/api/kratos/public/self-service/recovery?flow=199a2c74-08ca-4f22-b24c-3de3032682f8&token=XSpIPzkW4DgnJVhBG5Wjw3FZ0ORmGrrq",\n  "ui": {\n    "action": "https://playground.projects.oryapis.com/api/kratos/public/self-service/settings?flow=9b527900-2199-4221-9252-7971b3362282",\n    "method": "POST",\n    "messages": [\n      {\n        "id": 1060001,\n        "text": "You successfully recovered your account. Please change your password or set up an alternative login method (e.g. social sign in) within the next 15.00 minutes.",\n        "type": "info",\n        "context": {\n          "privilegedSessionExpiresAt": "2021-04-28T13:10:36.050848814Z"\n        }\n      }\n    ],\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "U3r/lgEfT8rA1Lg0Eeo06oGO8mX6T4TKoe/z7rbInhvYeacbRg0IW9zrqnpU1wmQJXKiekNzdLnypx5naHXoPg==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "profile",\n        "attributes": {\n          "name": "traits.email",\n          "type": "email",\n          "value": "foo@ory.sh",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "E-Mail",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "profile",\n        "attributes": {\n          "name": "traits.name.first",\n          "type": "text",\n          "value": "Foo",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "First Name",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "profile",\n        "attributes": {\n          "name": "traits.name.last",\n          "type": "text",\n          "value": "Bar",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "Last Name",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "profile",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "value": "profile",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070003,\n            "text": "Save",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "password",\n          "type": "password",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070001,\n            "text": "Password",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "value": "password",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070003,\n            "text": "Save",\n            "type": "info"\n          }\n        }\n      }\n    ]\n  },\n  "identity": {\n    "id": "b0a31645-0b5f-436a-b46d-03f15e8e89d9",\n    "schema_id": "default",\n    "schema_url": "https://playground.projects.oryapis.com/api/kratos/public/schemas/default",\n    "traits": {\n      "email": "foo@ory.sh",\n      "name": {\n        "first": "Foo",\n        "last": "Bar"\n      }\n    },\n    "verifiable_addresses": [\n      {\n        "id": "e3ea2845-0e07-4631-8955-9f4ecc5f73aa",\n        "value": "foo@ory.sh",\n        "verified": true,\n        "via": "email",\n        "status": "completed",\n        "verified_at": "2021-04-28T12:41:17.342366863Z"\n      }\n    ],\n    "recovery_addresses": [\n      {\n        "id": "fd66ee7e-5751-4282-bf27-414290084c19",\n        "value": "foo@ory.sh",\n        "via": "email"\n      }\n    ]\n  },\n  "state": "show_form"\n}\n'},66358:function(e,n,t){"use strict";n.Z=t.p+"assets/images/browser-email-missing-69ea020a0cddbff89b491f732b1d2dd1.png"},37470:function(e,n,t){"use strict";n.Z=t.p+"assets/images/browser-invalid-challenge-65c38ebdbc9abc6aea81dd25f84ba3f5.png"},89975:function(e,n,t){"use strict";n.Z=t.p+"assets/images/browser-settings-success-c322911a938d0d41e859182da98fc284.png"},95107:function(e,n,t){"use strict";n.Z=t.p+"assets/images/browser-success-8e227a51ec0b57fdf6e6d165eba4f63b.png"}}]);