(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[84261],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return h}});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),h=r,m=d["".concat(c,".").concat(h)]||d[h]||u[h]||i;return n?o.createElement(m,a(a({ref:t},p),{},{components:n})):o.createElement(m,a({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var l=2;l<i;l++)a[l]=n[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},63806:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return d}});var o=n(22122),r=n(19756),i=(n(67294),n(3905)),a=["components"],s={id:"hosting-own-have-i-been-pwned-api",title:"Hosting own Have I Been Pwned API"},c=void 0,l={unversionedId:"guides/hosting-own-have-i-been-pwned-api",id:"version-v0.7/guides/hosting-own-have-i-been-pwned-api",isDocsHomePage:!1,title:"Hosting own Have I Been Pwned API",description:"Ory Kratos uses the Have I Been Pwned (HiBP) API, with the k-anonymity flag, to",source:"@site/versioned_docs/version-v0.7/guides/hosting-own-have-i-been-pwned-api.mdx",sourceDirName:"guides",slug:"/guides/hosting-own-have-i-been-pwned-api",permalink:"/kratos/docs/guides/hosting-own-have-i-been-pwned-api",editUrl:"https://github.com/ory/kratos/edit/master/docs/versioned_docs/version-v0.7/guides/hosting-own-have-i-been-pwned-api.mdx",version:"v0.7",frontMatter:{id:"hosting-own-have-i-been-pwned-api",title:"Hosting own Have I Been Pwned API"}},p=[],u={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Ory Kratos uses the Have I Been Pwned (HiBP) API, with the k-anonymity flag, to\ncheck if the password the user registers with has been a part of one of the\nbreaches documented by the HiBP project."),(0,i.kt)("p",null,"In some environments, due to various CISO policies, it might be difficult to\nestablish egress connectivity to non-approved hosts. If it happens that your\nKratos operates in such an environment and it cannot communicate with the HiBP\nAPI at haveibeenpwned.com, but there is the requirement to check if passwords\nhave been leaked, you can host the HiBP API yourself and configure Kratos to use\nyour own instance."),(0,i.kt)("p",null,"To do so, configure Kratos to use your API:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/kratos/config.yml',title:'"path/to/kratos/config.yml'},"selfservice:\n  methods:\n    password:\n      config:\n        haveibeenpwned_host: api.private.host\n")),(0,i.kt)("p",null,"An example of a minimal self-hosted, k-anonymity enabled HiBP API\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/radekg/hibp"},"can be found in this repository"),"."),(0,i.kt)("p",null,"Alternatively, this feature can be disabled altogether. Note however that by\ndoing so you will significantly decrease the security of the service and not\nfollow ",(0,i.kt)("a",{parentName:"p",href:"https://pages.nist.gov/800-63-3/sp800-63b.html"},"NIST guidelines"),":"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"When processing requests to establish and change memorized secrets, verifiers\nSHALL compare the prospective secrets against a list that contains values\nknown to be commonly-used, expected, or compromised. For example, the list MAY\ninclude, but is not limited to:"),(0,i.kt)("ol",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ol"},"Passwords obtained from previous breach corpuses."),(0,i.kt)("li",{parentName:"ol"},"Dictionary words."),(0,i.kt)("li",{parentName:"ol"},"Repetitive or sequential characters (e.g. \u2018aaaaaa\u2019, \u20181234abcd\u2019)."),(0,i.kt)("li",{parentName:"ol"},"Context-specific words, such as the name of the service, the username, and\nderivatives thereof.")),(0,i.kt)("p",{parentName:"blockquote"},"If the chosen secret is found in the list, the CSP or verifier SHALL advise\nthe subscriber that they need to select a different secret, SHALL provide the\nreason for rejection, and SHALL require the subscriber to choose a different\nvalue.")),(0,i.kt)("p",null,"Disabling the feature will effectively remove checks for the points 1.-3. The\nfeature can be disabled by setting the following configuration values:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/kratos/config.yml',title:'"path/to/kratos/config.yml'},"selfservice:\n  methods:\n    password:\n      config:\n        haveibeenpwned_enabled: false\n")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Ory Kratos ",(0,i.kt)("inlineCode",{parentName:"p"},"haveibeenpwned_host")," setting does not allow configuring the\nrespective CA chain at the moment but it ",(0,i.kt)("strong",{parentName:"p"},"does require a TLS connection"),".\nTherefore your private HiBP API must use one of the trusted CAs of the\nunderlying operating system."),(0,i.kt)("p",{parentName:"div"},"A solution might be to host the HiBP API using a certificate issued by Let's\nEncrypt certificate or install the private CA certificate in the trusted CA\ncertificates of the system on which Kratos is running."))))}d.isMDXComponent=!0}}]);