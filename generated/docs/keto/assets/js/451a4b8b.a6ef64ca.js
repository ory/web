(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[89],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return p},kt:function(){return m}});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),m=o,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return t?a.createElement(h,r(r({ref:n},p),{},{components:t})):a.createElement(h,r({ref:n},p))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},94525:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return r},metadata:function(){return s},toc:function(){return l},default:function(){return p}});var a=t(22122),o=t(19756),i=(t(67294),t(3905)),r={id:"acp-ory",title:"ORY Access Control Policies"},s={unversionedId:"engines/acp-ory",id:"version-v0.5/engines/acp-ory",isDocsHomePage:!1,title:"ORY Access Control Policies",description:"At ORY, we use an Access Control Policy DSL modeled after AWS IAM Policies.",source:"@site/versioned_docs/version-v0.5/engines/acp-ory.md",sourceDirName:"engines",slug:"/engines/acp-ory",permalink:"/keto/docs/v0.5/engines/acp-ory",editUrl:"https://github.com/ory/keto/edit/master/docs/versioned_docs/version-v0.5/engines/acp-ory.md",version:"v0.5",lastUpdatedBy:"hackerman",lastUpdatedAt:1586170560,formattedLastUpdatedAt:"4/6/2020",frontMatter:{id:"acp-ory",title:"ORY Access Control Policies"},sidebar:"version-v0.5/docs",previous:{title:"Role Based Access Control (RBAC)",permalink:"/keto/docs/v0.5/engines/rbac"},next:{title:"AWS IAM Policies",permalink:"/keto/docs/v0.5/engines/acp-aws"}},l=[{value:"Precedence",id:"precedence",children:[]},{value:"Pattern Matching Strategies",id:"pattern-matching-strategies",children:[{value:"Case Sensitive Equality",id:"case-sensitive-equality",children:[]},{value:"Glob Pattern Matching",id:"glob-pattern-matching",children:[]},{value:"Regular Expressions",id:"regular-expressions",children:[]},{value:"Computational Overhead",id:"computational-overhead",children:[]}]},{value:"Conditions",id:"conditions",children:[{value:"CIDR Condition",id:"cidr-condition",children:[]},{value:"String Match Condition",id:"string-match-condition",children:[]},{value:"Subject Condition",id:"subject-condition",children:[]},{value:"String Pairs Equal Condition",id:"string-pairs-equal-condition",children:[]}]},{value:"Roles",id:"roles",children:[]},{value:"Implementation Status",id:"implementation-status",children:[]},{value:"Best Practices",id:"best-practices",children:[{value:"URNs",id:"urns",children:[]},{value:"Scope the Organization Name",id:"scope-the-organization-name",children:[]},{value:"Scope Actions, Resources and Subjects",id:"scope-actions-resources-and-subjects",children:[]},{value:"Multi-Tenant Systems",id:"multi-tenant-systems",children:[]}]}],c={toc:l};function p(e){var n=e.components,t=(0,o.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"At ORY, we use an Access Control Policy DSL modeled after AWS IAM Policies.\nThese policies define ",(0,i.kt)("inlineCode",{parentName:"p"},"effects")," for ",(0,i.kt)("inlineCode",{parentName:"p"},"subjects")," who perform ",(0,i.kt)("inlineCode",{parentName:"p"},"actions")," on\n",(0,i.kt)("inlineCode",{parentName:"p"},"resources"),". For example, ",(0,i.kt)("inlineCode",{parentName:"p"},"Alice")," (subject aka identity aka user) is ",(0,i.kt)("inlineCode",{parentName:"p"},"allowed"),"\n(effect) to ",(0,i.kt)("inlineCode",{parentName:"p"},"delete")," (action) blog article with ID ",(0,i.kt)("inlineCode",{parentName:"p"},"my-first-blog-post"),"\n(",(0,i.kt)("inlineCode",{parentName:"p"},"resource"),"). This is comparable to how ACLs work:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["alice"],\n  "resources": ["blog_posts:my-first-blog-post"],\n  "actions": ["delete"],\n  "effect": "allow"\n}\n')),(0,i.kt)("p",null,"The policy above allows ",(0,i.kt)("inlineCode",{parentName:"p"},"Alice")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"delete")," ",(0,i.kt)("inlineCode",{parentName:"p"},"blog_posts:my-first-blog-post"),". We\ncould apply this policy to more subjects and also more actions or resources, if\nwe want to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["alice", "bob"],\n  "resources": [\n    "blog_posts:my-first-blog-post",\n    "blog_posts:2",\n    "blog_posts:3"\n  ],\n  "actions": ["delete", "create", "read", "modify"],\n  "effect": "allow"\n}\n')),(0,i.kt)("p",null,"Well, this looks like ACL in disguise so far. So what's different?"),(0,i.kt)("h2",{id:"precedence"},"Precedence"),(0,i.kt)("p",null,"The first difference is that we can explicitly deny access:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["peter"],\n  "resources": [\n    "blog_posts:my-first-blog-post",\n    "blog_posts:2",\n    "blog_posts:3"\n  ],\n  "actions": ["delete", "create", "read", "modify"],\n  "effect": "deny"\n}\n')),(0,i.kt)("p",null,"The policy decision point (the one checking if something is allowed or not)\napplies the following rule set when deciding if something is allowed or not:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If a policy for a given subject, action, and resource matches, and the effect\nis ",(0,i.kt)("inlineCode",{parentName:"li"},"deny"),", the request is always denied."),(0,i.kt)("li",{parentName:"ol"},"If no policy with effect ",(0,i.kt)("inlineCode",{parentName:"li"},"deny")," matches, and at least one policy with effect\n",(0,i.kt)("inlineCode",{parentName:"li"},"allow"),", the request is allowed."),(0,i.kt)("li",{parentName:"ol"},"If no policies match at all, the request is denied.")),(0,i.kt)("h2",{id:"pattern-matching-strategies"},"Pattern Matching Strategies"),(0,i.kt)("p",null,"ORY Keto has implements several ORY ACP pattern matching strategies."),(0,i.kt)("h3",{id:"case-sensitive-equality"},"Case Sensitive Equality"),(0,i.kt)("p",null,"The easiest pattern matching strategy is the case sensitive equality check. This\nstrategy simply checks if two strings are exactly the same. Assuming a policy\ndefines ",(0,i.kt)("inlineCode",{parentName:"p"},'{"subjects": ["alice", "boB"] }'),", then it will match exactly subjects\n",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"boB"),"."),(0,i.kt)("h3",{id:"glob-pattern-matching"},"Glob Pattern Matching"),(0,i.kt)("p",null,"ORY Keto supports matching URNs with glob pattern matching. Policy"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["users:*"],\n  "actions": ["get", "create"],\n  "resources": ["resources:articles:*", "resources:{accounts,profiles}:*"],\n  "effect": "allow"\n}\n')),(0,i.kt)("p",null,"for example will match the following inputs:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "get",\n  "resource": "resources:profiles:foo"\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},":")," is a delimiter in ORY Access Control Policies. Other supported syntax\nis:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"single symbol wildcard:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"?at")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"cat")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"bat")," but not ",(0,i.kt)("inlineCode",{parentName:"li"},"at")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"wildcard:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:*:bar")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:baz:bar")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:zab:bar")," but not\n",(0,i.kt)("inlineCode",{parentName:"li"},"foo:bar")," nor ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:baz:baz:bar")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"super wildcard:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:**:bar")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:baz:baz:bar"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:baz:bar"),", and\n",(0,i.kt)("inlineCode",{parentName:"li"},"foo:bar"),", but not ",(0,i.kt)("inlineCode",{parentName:"li"},"foobar")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"foo:baz")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"character list:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"[cb]at")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"cat")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"bat")," but not ",(0,i.kt)("inlineCode",{parentName:"li"},"mat")," nor ",(0,i.kt)("inlineCode",{parentName:"li"},"at"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"negated character list:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"[!cb]at")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"tat")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"mat")," but not ",(0,i.kt)("inlineCode",{parentName:"li"},"cat"),"\nnor ",(0,i.kt)("inlineCode",{parentName:"li"},"bat"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"ranged character list:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"[a-c]at")," ",(0,i.kt)("inlineCode",{parentName:"li"},"cat")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"bat")," but not ",(0,i.kt)("inlineCode",{parentName:"li"},"mat")," nor ",(0,i.kt)("inlineCode",{parentName:"li"},"at"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"negated ranged character list:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"[!a-c]at")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"mat")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"tat")," but not\n",(0,i.kt)("inlineCode",{parentName:"li"},"cat")," nor ",(0,i.kt)("inlineCode",{parentName:"li"},"bat"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"alternatives list:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"{cat,bat,[mt]at}")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"cat"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"bat"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"mat"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"tat"),"\nand nothing else."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"backslash:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"foo\\\\bar")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"foo\\bar")," and nothing else. ",(0,i.kt)("inlineCode",{parentName:"li"},"foo\\bar"),"\nmatches ",(0,i.kt)("inlineCode",{parentName:"li"},"foobar")," and nothing else. ",(0,i.kt)("inlineCode",{parentName:"li"},"foo\\*bar")," matches ",(0,i.kt)("inlineCode",{parentName:"li"},"foo*bar")," and nothing\nelse. Please note that when using JSON you need to double escape backslashes:\n",(0,i.kt)("inlineCode",{parentName:"li"},"foo\\\\bar")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},'{"...": "foo\\\\\\\\bar"}'),".")),(0,i.kt)("p",null,"The pattern syntax is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"  pattern:\n      { term }\n\n  term:\n      `*`         matches any sequence of non-separator characters\n      `**`        matches any sequence of characters\n      `?`         matches any single non-separator character\n      `[` [ `!` ] { character-range } `]`\n                  character class (must be non-empty)\n      `{` pattern-list `}`\n                  pattern alternatives\n      c           matches character c (c != `*`, `**`, `?`, `\\`, `[`, `{`, `}`)\n      `\\` c       matches character c\n\n  character-range:\n      c           matches character c (c != `\\\\`, `-`, `]`)\n      `\\` c       matches character c\n      lo `-` hi   matches character c for lo <= c <= hi\n\n  pattern-list:\n      pattern { `,` pattern }\n                  comma-separated (without spaces) patterns\n")),(0,i.kt)("h3",{id:"regular-expressions"},"Regular Expressions"),(0,i.kt)("p",null,"ORY Keto also allows pattern matching with regular expressions. This depend on\nhow you name your subjects, resources, and actions. More on that topic in the\n",(0,i.kt)("a",{parentName:"p",href:"#best-practices"},"Best Practices")," section."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["users:<.*>"]\n}\n')),(0,i.kt)("p",null,"In this example, the (incomplete) policy would match every subject that is\nprefixed with ",(0,i.kt)("inlineCode",{parentName:"p"},"users:"),", so for example ",(0,i.kt)("inlineCode",{parentName:"p"},"users:alice"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"users:bob"),". ORY Ladon and\nORY Keto delimit regular expressions with ",(0,i.kt)("inlineCode",{parentName:"p"},"<")," and ",(0,i.kt)("inlineCode",{parentName:"p"},">"),". For example, ",(0,i.kt)("inlineCode",{parentName:"p"},'"users:.*"'),"\nis not a valid regular expression, just a simple string."),(0,i.kt)("p",null,"The next example will allow all subjects with prefix ",(0,i.kt)("inlineCode",{parentName:"p"},"user:")," to read\n(",(0,i.kt)("inlineCode",{parentName:"p"},"actions:read"),") all resources that match ",(0,i.kt)("inlineCode",{parentName:"p"},"resources:blog_posts:<[0-9]+>")," (e.g.\n",(0,i.kt)("inlineCode",{parentName:"p"},"resources:blog_posts:1234")," but not ",(0,i.kt)("inlineCode",{parentName:"p"},"resources:blog_posts:abcde"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["users:<.*>"],\n  "resources": ["resources:blog_posts:<[0-9]+>"],\n  "actions": ["actions:read"],\n  "effect": "allow"\n}\n')),(0,i.kt)("h3",{id:"computational-overhead"},"Computational Overhead"),(0,i.kt)("p",null,"Some pattern matching strategies can introduce computational complexity.\nConsider the performance implications when choosing an approach:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Case sensitive equality: no computational overhead"),(0,i.kt)("li",{parentName:"ul"},"Glob pattern matching: little computational overhead"),(0,i.kt)("li",{parentName:"ul"},"Regex: considerable computational overhead")),(0,i.kt)("h2",{id:"conditions"},"Conditions"),(0,i.kt)("p",null,"So far, we covered that an ORY ACP applies to a list of ",(0,i.kt)("inlineCode",{parentName:"p"},"subjects"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"resources"),",\nand ",(0,i.kt)("inlineCode",{parentName:"p"},"actions"),". Conditions narrow down the use cases in which a certain ACP\napplies. A condition may, for example, mandate that the IP Address of the client\nmaking the request has to match ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.0.0/16")," or that the subject is also the\nowner of the resource. Here is an example for the former condition:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "description": "One policy to rule them all",\n  "subjects": ["users:maria"],\n  "actions": ["delete", "create", "update"],\n  "effect": "allow",\n  "resources": ["resources:articles:<.*>"],\n  "conditions": {\n    "remoteIPAddress": {\n      "type": "CIDRCondition",\n      "options": {\n        "cidr": "192.168.0.0/16"\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"Conditions are a part of policies. They determine if a policy can decide the\ncurrent access request in the current context. Context is the larger environment\nin which the access request happens. A condition has this JSON format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["..."],\n  "actions": ["..."],\n  "effect": "allow",\n  "resources": ["..."],\n  "conditions": {\n    "this-key-will-be-matched-with-the-context": {\n      "type": "SomeConditionType",\n      "options": {\n        "some": "configuration options set by the condition type"\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"Conditions are functions returning true or false given a context. Because\nconditions implement logic, they must be programmed. ORY Keto provides the\nfollowing commonly used conditions out of the box. You can improve or extend\nthem."),(0,i.kt)("h3",{id:"cidr-condition"},"CIDR Condition"),(0,i.kt)("p",null,"The CIDR condition matches CIDR IP Ranges. A possible policy definition could\nlook like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "description": "One policy to rule them all.",\n  "subjects": ["users:maria"],\n  "actions": ["delete", "create", "update"],\n  "effect": "allow",\n  "resources": ["resources:articles:<.*>"],\n  "conditions": {\n    "remoteIPAddress": {\n      "type": "CIDRCondition",\n      "options": {\n        "cidr": "192.168.0.0/16"\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be allowed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "remoteIPAddress": "192.168.0.5"\n  }\n}\n')),(0,i.kt)("p",null,"The next access request would be denied as the condition is not fulfilled and\nthus no policy matches."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "remoteIPAddress": "255.255.0.0"\n  }\n}\n')),(0,i.kt)("p",null,"The next access request would also be denied as the context is not using the key\n",(0,i.kt)("inlineCode",{parentName:"p"},"remoteIPAddress")," but instead ",(0,i.kt)("inlineCode",{parentName:"p"},"someOtherKey"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "someOtherKey": "192.168.0.5"\n  }\n}\n')),(0,i.kt)("h5",{id:"string-equal-condition"},"String Equal Condition"),(0,i.kt)("p",null,"This condition matches if the value passed in the access request's context is\nidentical with the string defined in the condition."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "description": "One policy to rule them all.",\n  "subjects": ["users:maria"],\n  "actions": ["delete", "create", "update"],\n  "effect": "allow",\n  "resources": ["resources:articles:<.*>"],\n  "conditions": {\n    "myKey": {\n      "type": "StringEqualCondition",\n      "options": {\n        "equals": "expected-value"\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be allowed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "myKey": "expected-value"\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be denied."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "meKey": "another-value"\n  }\n}\n')),(0,i.kt)("h3",{id:"string-match-condition"},"String Match Condition"),(0,i.kt)("p",null,"This condition applies when the value passed in the access request's context\nmatches the regular expression in the condition."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "description": "One policy to rule them all.",\n  "subjects": ["users:maria"],\n  "actions": ["delete", "create", "update"],\n  "effect": "allow",\n  "resources": ["resources:articles:<.*>"],\n  "conditions": {\n    "someKeyName": {\n      "type": "StringMatchCondition",\n      "options": {\n        "matches": "foo.+"\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be allowed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "someKeyName": "foo-bar"\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be denied."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "someKeyName": "bar"\n  }\n}\n')),(0,i.kt)("h3",{id:"subject-condition"},"Subject Condition"),(0,i.kt)("p",null,"This condition matches when the access request's subject is identical with the\nstring specified in the condition."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "description": "One policy to rule them all.",\n  "subjects": ["users:maria"],\n  "actions": ["delete", "create", "update"],\n  "effect": "allow",\n  "resources": ["resources:articles:<.*>"],\n  "conditions": {\n    "owner": {\n      "type": "EqualsSubjectCondition",\n      "options": {}\n    }\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be allowed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "owner": "users:maria"\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be denied."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "owner": "another-user"\n  }\n}\n')),(0,i.kt)("p",null,"This condition makes sense together with access tokens, where the subject is\nextracted from the token."),(0,i.kt)("h3",{id:"string-pairs-equal-condition"},"String Pairs Equal Condition"),(0,i.kt)("p",null,"This condition matches when the value passed in the access request's context\ncontains two-element arrays and both elements in each pair are equal."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "description": "One policy to rule them all.",\n  "subjects": ["users:maria"],\n  "actions": ["delete", "create", "update"],\n  "effect": "allow",\n  "resources": ["resources:articles:<.*>"],\n  "conditions": {\n    "someKey": {\n      "type": "StringPairsEqualCondition",\n      "options": {}\n    }\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be allowed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "someKey": [\n      ["foo", "foo"],\n      ["bar", "bar"]\n    ]\n  }\n}\n')),(0,i.kt)("p",null,"The following access request would be denied."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subject": "users:maria",\n  "action": "delete",\n  "resource": "resources:articles:12345",\n  "context": {\n    "someKey": [["foo", "bar"]]\n  }\n}\n')),(0,i.kt)("h2",{id:"roles"},"Roles"),(0,i.kt)("p",null,"Similar to RBAC, ORY ACPs support the concept of roles. This feature allows\ngrouping a number of subjects under the same role. Whenever making a request to\nthe Allowed API, it will check the roles of a subject (if there are any) and use\nthem when looking up the ",(0,i.kt)("inlineCode",{parentName:"p"},"subjects")," field."),(0,i.kt)("p",null,"Assuming the following policies:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["bob"],\n  "resources": ["blog_posts:my-first-blog-post"],\n  "actions": ["create"],\n  "effect": "allow"\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "subjects": ["admin"],\n  "resources": ["blog_posts:my-first-blog-post"],\n  "actions": ["delete"],\n  "effect": "allow"\n}\n')),(0,i.kt)("p",null,"As you can see, ",(0,i.kt)("inlineCode",{parentName:"p"},"bob")," is allowed to create resource\n",(0,i.kt)("inlineCode",{parentName:"p"},"blog_posts:my-first-blog-post")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," is allowed to delete it. Making the\nfollowing request to the Allowed API"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n  "subject": "bob",\n  "action" : "delete",\n  "resource": "blog_posts:my-first-blog-post"\n}\n')),(0,i.kt)("p",null,"will return ",(0,i.kt)("inlineCode",{parentName:"p"},'{ "allowed": false }')," while this request"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n  "subject": "admin",\n  "action" : "delete",\n  "resource": "blog_posts:my-first-blog-post"\n}\n')),(0,i.kt)("p",null,"will return ",(0,i.kt)("inlineCode",{parentName:"p"},'{ "allowed": true }'),"."),(0,i.kt)("h2",{id:"implementation-status"},"Implementation Status"),(0,i.kt)("p",null,"ORY Access Control Policies (regex, glob, equality) are first-class citizens."),(0,i.kt)("h2",{id:"best-practices"},"Best Practices"),(0,i.kt)("p",null,"This sections gives an overview of best practices for access control policies we\ndeveloped over the years at ORY."),(0,i.kt)("h3",{id:"urns"},"URNs"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u201cThere are only two hard things in Computer Science: cache invalidation,\nnaming things, and off-by-one errors.\u201d -- Phil Karlton")),(0,i.kt)("p",null,"URN naming is as hard as naming API endpoints. Thankfully, doing the latter\ntypically provides a solution for the former as well."),(0,i.kt)("h3",{id:"scope-the-organization-name"},"Scope the Organization Name"),(0,i.kt)("p",null,"It is good security practice is to prefix resource names with a domain that\nrepresents the organization creating the software."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do not:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"my-resource")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:my-resource"))),(0,i.kt)("h3",{id:"scope-actions-resources-and-subjects"},"Scope Actions, Resources and Subjects"),(0,i.kt)("p",null,"Provide a scope for actions, resources, and subjects to prevent name collisions:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do not:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:<subject-id>"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:<resource-id>"),",\n",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:<action-id>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:subjects:<subject-id>"),",\n",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:resources:<resource-id>"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"myorg.com:actions:<action-id>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"subjects:myorg.com:<subject-id>"),",\n",(0,i.kt)("inlineCode",{parentName:"li"},"resources:myorg.com:<resource-id>"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"actions:myorg.com:<action-id>"))),(0,i.kt)("h3",{id:"multi-tenant-systems"},"Multi-Tenant Systems"),(0,i.kt)("p",null,"Multi-tenant systems typically have resources which should not be accessed by\nother tenants in the system. This can be achieved by adding the tenant id to the\nURN:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do:")," ",(0,i.kt)("inlineCode",{parentName:"li"},"resources:myorg.com:tenants:<tenant-id>:<resource-id>"))),(0,i.kt)("p",null,"Some environments have organizations and projects belonging to those\norganizations. The following URN semantics can be used in these situations:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Do:"),(0,i.kt)("inlineCode",{parentName:"li"},"resources:myorg.com:organizations:<organization-id>:projects:<project-id>:<resource-id>"))))}p.isMDXComponent=!0}}]);